<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAGç³»ç»ŸV2.0æ¶æ„ - æ·±åº¦äº¤äº’å¼å­¦ä¹ å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .header .features {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 0.95em;
        }

        .header .features span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ä¸»å¸ƒå±€ï¼šå·¦ä¾§æ§åˆ¶é¢æ¿ï¼Œä¸­é—´æµç¨‹å›¾ï¼Œå³ä¾§ä¿¡æ¯é¢æ¿ */
        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr 400px;
            gap: 20px;
            margin-bottom: 30px;
            height: calc(100vh - 180px);
            align-items: stretch;
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: 100%;
            overflow-y: auto;
        }

        .control-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section h3 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mode-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 0.95em;
        }

        .mode-btn:hover {
            border-color: #2a5298;
            transform: translateX(5px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .mode-btn .subtitle {
            font-size: 0.8em;
            opacity: 0.8;
            margin-top: 4px;
        }

        /* æ·±åº¦å­¦ä¹ å¡ç‰‡ */
        .learning-card {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8eeff 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .learning-card h4 {
            color: #2a5298;
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .concept-box {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }

        .concept-box strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        /* ä¸­é—´æµç¨‹å¯è§†åŒ–åŒºåŸŸ */
        .flow-visualization {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            height: 100%;
            overflow-y: auto;
        }

        .stage-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }

        /* èŠ‚ç‚¹æ ·å¼ */
        .flow-node {
            fill: #f0f4ff;
            stroke: #667eea;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s;
        }

        .flow-node:hover {
            fill: #e8eeff;
            stroke-width: 3;
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.3));
        }

        .flow-node.active {
            fill: #667eea;
            stroke-width: 3;
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }

        .flow-node.completed {
            fill: #d4edda;
            stroke: #28a745;
        }

        .flow-node.clickable {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .node-text {
            fill: #333;
            font-size: 12px;
            text-anchor: middle;
            pointer-events: none;
        }

        .node-text.active {
            fill: white;
            font-weight: bold;
        }

        /* ç®¡é“è¿çº¿ */
        .pipeline-path {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 3;
            stroke-dasharray: 5, 5;
        }

        .pipeline-path.active {
            stroke: #667eea;
            stroke-dasharray: none;
            animation: pulseStroke 1s infinite;
        }

        @keyframes pulseStroke {
            0%, 100% { stroke-width: 3; }
            50% { stroke-width: 5; }
        }

        /* å³ä¾§ä¿¡æ¯é¢æ¿ */
        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: 100%;
            overflow-y: auto;
        }

        .info-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .info-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            position: relative;
        }

        .info-tab:hover {
            color: #2a5298;
        }

        .info-tab.active {
            color: #667eea;
            font-weight: 600;
        }

        .info-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ä»£ç å—æ ·å¼ */
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-block .keyword {
            color: #569cd6;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .comment {
            color: #6a9955;
        }

        .code-block .function {
            color: #dcdcaa;
        }

        /* å¯¹æ¯”è¡¨æ ¼ */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: #f8f9fa;
            color: #2a5298;
            font-weight: 600;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table .check {
            color: #28a745;
        }

        .comparison-table .cross {
            color: #dc3545;
        }

        /* å‘é‡ç©ºé—´å¯è§†åŒ– */
        .vector-space-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f4ff 100%);
            border: 2px solid #007bff;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,123,255,0.1);
        }

        .vector-canvas {
            border: 2px solid #007bff;
            border-radius: 12px;
            background: white;
            margin: 15px auto;
            display: block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* æ€§èƒ½æŒ‡æ ‡ */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .metric-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2a5298;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        /* åŠ¨æ€å³ä¾§é¢æ¿æ ·å¼ */
        .node-selected {
            border: 3px solid #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
        }

        .panel-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .panel-section h4 {
            color: #2a5298;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .state-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .state-indicator.dev {
            background: #e3f2fd;
            color: #1976d2;
        }

        .state-indicator.manage {
            background: #fff3e0;
            color: #f57c00;
        }

        .state-indicator.runtime {
            background: #e8f5e8;
            color: #388e3c;
        }

        /* ç±»æ¯”è¯´æ˜æ¡† */
        .analogy-box {
            background: #fffbf0;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .analogy-box h5 {
            color: #856404;
            margin-bottom: 10px;
        }

        .analogy-box .analogy-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }

        .analogy-box .icon {
            font-size: 1.5em;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1600px) {
            .main-layout {
                grid-template-columns: 280px 1fr 350px;
            }
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .control-panel,
            .info-panel {
                max-height: none;
            }
        }

        /* æç¤ºæ¡† */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            max-width: 300px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            line-height: 1.4;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        /* æ·±åº¦è§£é‡Šé¢æ¿ */
        .deep-explanation {
            background: #f0f8ff;
            border: 2px solid #2a5298;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .deep-explanation h4 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .explanation-section {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .explanation-section h5 {
            color: #667eea;
            margin-bottom: 10px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #667eea;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ RAGç³»ç»ŸV2.0æ¶æ„ - æ·±åº¦äº¤äº’å¼å­¦ä¹ å¹³å°</h1>
            <p>ç‚¹å‡»æ¯ä¸ªç»„ä»¶æ·±å…¥äº†è§£åŸç†ã€æŸ¥çœ‹ä»£ç ã€è§‚å¯Ÿè¿è¡ŒçŠ¶æ€</p>
            <div class="features">
                <span>ğŸ“š æ·±åº¦æ•™å­¦</span>
                <span>ğŸ” å‘é‡è¯­ä¹‰æœç´¢</span>
                <span>ğŸ¤– åŒæ¨¡å‹æ¶æ„</span>
                <span>ğŸ’» çœŸå®ä»£ç å±•ç¤º</span>
                <span>âš¡ å®æ—¶æ•°æ®æµ</span>
            </div>
        </div>

        <div class="main-layout">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>ğŸ® ç³»ç»Ÿæ¨¡å¼</h3>
                    <div class="mode-selector">
                        <button class="mode-btn active" onclick="switchMode('dev', event)">
                            ğŸ› ï¸ å¼€å‘æ€ - ç³»ç»Ÿé…ç½®
                            <div class="subtitle">ç†è§£ç»„ä»¶åˆå§‹åŒ–åŸç†</div>
                        </button>
                        <button class="mode-btn" onclick="switchMode('manage', event)">
                            ğŸ“‹ ç®¡ç†æ€ - æ–‡æ¡£å¤„ç†
                            <div class="subtitle">å­¦ä¹ å‘é‡åŒ–è¿‡ç¨‹</div>
                        </button>
                        <button class="mode-btn" onclick="switchMode('runtime', event)">
                            ğŸš€ è¿è¡Œæ€ - æŸ¥è¯¢å¤„ç†
                            <div class="subtitle">ä½“éªŒå®Œæ•´æ•°æ®æµ</div>
                        </button>
                    </div>
                </div>

                <!-- åŠ¨æ€å­¦ä¹ å¡ç‰‡ - æ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹ -->
                <div class="learning-card" id="context-learning-card">
                    <h4 id="learning-card-title">ğŸ“ ä¸ºä»€ä¹ˆç”¨å‘é‡æ•°æ®åº“ï¼Ÿ</h4>
                    <div id="learning-card-content">
                        <div class="concept-box">
                            <strong>ä¼ ç»Ÿæ•°æ®åº“çš„å±€é™ï¼š</strong>
                            åªèƒ½ç²¾ç¡®åŒ¹é…å…³é”®è¯ï¼Œæ— æ³•ç†è§£è¯­ä¹‰
                        </div>
                        <div class="concept-box">
                            <strong>å‘é‡æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š</strong>
                            ç†è§£"æ„æ€ç›¸è¿‘"çš„å†…å®¹ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢
                        </div>
                        <div class="analogy-box">
                            <h5>ğŸ’¡ ç”Ÿæ´»ç±»æ¯”</h5>
                            <div class="analogy-item">
                                <span class="icon">ğŸ“š</span>
                                <span>ä¼ ç»ŸDB = å›¾ä¹¦é¦†ä¹¦åç´¢å¼•</span>
                            </div>
                            <div class="analogy-item">
                                <span class="icon">ğŸ§ </span>
                                <span>å‘é‡DB = å›¾ä¹¦ç®¡ç†å‘˜çš„çŸ¥è¯†</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¼”ç¤ºæ§åˆ¶ -->
                <div class="control-section">
                    <h3>ğŸ® æ¼”ç¤ºæ§åˆ¶</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn" onclick="startDemo()" id="demo-btn">
                            â–¶ï¸ å¼€å§‹æ¼”ç¤º
                        </button>
                        <button class="btn btn-secondary" onclick="resetDemo()">
                            ğŸ”„ é‡ç½®
                        </button>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 0.9em;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>çŠ¶æ€:</span>
                                <span id="status-text" style="color: #28a745; font-weight: bold;">å‡†å¤‡å°±ç»ª</span>
                            </div>
                            <div style="margin-top: 8px;">
                                <div style="background: #e0e0e0; height: 4px; border-radius: 2px;">
                                    <div id="progress-fill" style="background: #28a745; height: 100%; width: 0%; border-radius: 2px; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´æµç¨‹å¯è§†åŒ– -->
            <div class="flow-visualization">
                <div class="stage-title" id="stage-title">ğŸ› ï¸ å¼€å‘æ€ - ç³»ç»Ÿåˆå§‹åŒ–</div>
                
                <!-- å¼€å‘æ€å¯è§†åŒ– -->
                <div id="dev-flow" class="flow-content">
                    <svg class="pipeline-svg" viewBox="0 0 900 600" style="width: 100%; height: 500px;">
                        <!-- é…ç½®è¯»å–èŠ‚ç‚¹ -->
                        <g class="node-group" onclick="showNodeDetail('config')">
                            <rect x="50" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="config-node"/>
                            <text x="125" y="85" class="node-text">ğŸ“„ é…ç½®è¯»å–</text>
                            <text x="125" y="105" class="node-text" style="font-size: 14px;">.envæ–‡ä»¶</text>
                        </g>
                        
                        <!-- å‘é‡æ•°æ®åº“èŠ‚ç‚¹ - å¯ç‚¹å‡»äº†è§£æ·±åº¦åŸç† -->
                        <g class="node-group" onclick="showNodeDetail('vectordb')">
                            <rect x="250" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="vectordb-node"/>
                            <text x="325" y="85" class="node-text">ğŸ—„ï¸ å‘é‡æ•°æ®åº“</text>
                            <text x="325" y="105" class="node-text" style="font-size: 14px;">ChromaDB</text>
                        </g>
                        
                        <!-- åµŒå…¥æ¨¡å‹èŠ‚ç‚¹ - å¯ç‚¹å‡»äº†è§£MiniLM-L6 -->
                        <g class="node-group" onclick="showNodeDetail('embedding')">
                            <rect x="450" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="embedding-node"/>
                            <text x="525" y="85" class="node-text">ğŸ”¢ åµŒå…¥æ¨¡å‹</text>
                            <text x="525" y="105" class="node-text" style="font-size: 14px;">MiniLM-L6</text>
                        </g>
                        
                        <!-- AIæ¨¡å‹é…ç½®èŠ‚ç‚¹ -->
                        <g class="node-group" onclick="showNodeDetail('ai-config')">
                            <rect x="150" y="200" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="ai-config-node"/>
                            <text x="225" y="235" class="node-text">ğŸ¤– AIæ¨¡å‹é…ç½®</text>
                            <text x="225" y="255" class="node-text" style="font-size: 14px;">DeepSeekåŒæ¨¡å‹</text>
                        </g>
                        
                        <!-- æ™ºèƒ½è·¯ç”±å™¨èŠ‚ç‚¹ - å¯ç‚¹å‡»äº†è§£è·¯ç”±å†³ç­– -->
                        <g class="node-group" onclick="showNodeDetail('router')">
                            <rect x="350" y="200" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="router-node"/>
                            <text x="425" y="235" class="node-text">ğŸš¦ æ™ºèƒ½è·¯ç”±å™¨</text>
                            <text x="425" y="255" class="node-text" style="font-size: 14px;">ä»»åŠ¡åˆ†å‘</text>
                        </g>
                        
                        <!-- è¿æ¥çº¿ -->
                        <path d="M200,90 L250,90" class="pipeline-path" id="path1"/>
                        <path d="M400,90 L450,90" class="pipeline-path" id="path2"/>
                        <path d="M325,130 L325,170 L225,170 L225,200" class="pipeline-path" id="path3"/>
                        <path d="M300,240 L350,240" class="pipeline-path" id="path4"/>
                        
                        <!-- ç‚¹å‡»æç¤º -->
                        <text x="450" y="350" style="fill: #667eea; font-size: 14px; text-anchor: middle;">
                            ğŸ’¡ ç‚¹å‡»ä»»æ„ç»„ä»¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                        </text>
                    </svg>
                    
                    <!-- MiniLM-L6æ·±åº¦è§£é‡Š -->
                    <div class="deep-explanation">
                        <h4>ğŸ”¬ MiniLM-L6æ¨¡å‹ï¼šæ–‡æœ¬å¦‚ä½•å˜æˆå‘é‡ï¼Ÿ</h4>
                        <div class="explanation-section">
                            <h5>1ï¸âƒ£ åˆ†è¯ï¼ˆTokenizationï¼‰</h5>
                            <p>"Pythonç¼–ç¨‹åŸºç¡€" â†’ ["Python", "ç¼–ç¨‹", "åŸºç¡€"]</p>
                        </div>
                        <div class="explanation-section">
                            <h5>2ï¸âƒ£ ç¼–ç ï¼ˆEncodingï¼‰</h5>
                            <p>["Python", "ç¼–ç¨‹", "åŸºç¡€"] â†’ [101, 2348, 1523, 102]</p>
                        </div>
                        <div class="explanation-section">
                            <h5>3ï¸âƒ£ åµŒå…¥ï¼ˆEmbeddingï¼‰</h5>
                            <p>[101, 2348, 1523, 102] â†’ [0.23, -0.45, 0.67, ...] (384ç»´)</p>
                        </div>
                        <div class="code-block">
<span class="comment"># å®é™…Pythonä»£ç </span>
<span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer

<span class="comment"># åŠ è½½æ¨¡å‹ï¼ˆä»…25MBï¼Œè½»é‡é«˜æ•ˆï¼‰</span>
model = SentenceTransformer(<span class="string">'all-MiniLM-L6-v2'</span>)

<span class="comment"># æ–‡æœ¬è½¬å‘é‡</span>
text = <span class="string">"Pythonç¼–ç¨‹åŸºç¡€"</span>
vector = model.encode(text)  <span class="comment"># è¿”å›384ç»´å‘é‡</span>
<span class="keyword">print</span>(f<span class="string">"å‘é‡ç»´åº¦: {len(vector)}"</span>)  <span class="comment"># è¾“å‡º: 384</span>
                        </div>
                    </div>
                </div>

                <!-- ç®¡ç†æ€å¯è§†åŒ– -->
                <div id="manage-flow" class="flow-content" style="display: none;">
                    <svg class="pipeline-svg" viewBox="0 0 900 600" style="width: 100%; height: 500px;">
                        <!-- æ–‡æ¡£å¤„ç†æµç¨‹èŠ‚ç‚¹ -->
                        <g class="node-group" onclick="showManageNodeDetail('doc-input')">
                            <rect x="50" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="doc-input-node"/>
                            <text x="125" y="85" class="node-text">ğŸ“¥ æ–‡æ¡£è¾“å…¥</text>
                            <text x="125" y="105" class="node-text" style="font-size: 14px;">MD/PDF/TXT</text>
                        </g>
                        
                        <g class="node-group" onclick="showManageNodeDetail('doc-parse')">
                            <rect x="250" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="doc-parse-node"/>
                            <text x="325" y="85" class="node-text">ğŸ” æ–‡æ¡£è§£æ</text>
                            <text x="325" y="105" class="node-text" style="font-size: 14px;">æå–å†…å®¹</text>
                        </g>
                        
                        <g class="node-group" onclick="showManageNodeDetail('chunk')">
                            <rect x="450" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="chunk-node"/>
                            <text x="525" y="85" class="node-text">âœ‚ï¸ æ–‡æœ¬åˆ†å—</text>
                            <text x="525" y="105" class="node-text" style="font-size: 14px;">500å­—ç¬¦/å—</text>
                        </g>
                        
                        <g class="node-group" onclick="showManageNodeDetail('vectorize')">
                            <rect x="650" y="50" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="vectorize-node"/>
                            <text x="725" y="85" class="node-text">ğŸ”¢ å‘é‡åŒ–</text>
                            <text x="725" y="105" class="node-text" style="font-size: 14px;">384ç»´å‘é‡</text>
                        </g>
                        
                        <g class="node-group" onclick="showManageNodeDetail('store')">
                            <rect x="350" y="250" width="150" height="80" rx="10" 
                                  class="flow-node clickable" id="store-node"/>
                            <text x="425" y="285" class="node-text">ğŸ’¾ æ•°æ®å­˜å‚¨</text>
                            <text x="425" y="305" class="node-text" style="font-size: 14px;">ChromaDB</text>
                        </g>
                        
                        <!-- è¿æ¥çº¿ -->
                        <path d="M200,90 L250,90" class="pipeline-path"/>
                        <path d="M400,90 L450,90" class="pipeline-path"/>
                        <path d="M600,90 L650,90" class="pipeline-path"/>
                        <path d="M725,130 L725,190 L425,190 L425,250" class="pipeline-path"/>
                        
                        <!-- ç‚¹å‡»æç¤º -->
                        <text x="450" y="450" style="fill: #667eea; font-size: 14px; text-anchor: middle;">
                            ğŸ’¡ ç‚¹å‡»ä»»æ„ç»„ä»¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                        </text>
                    </svg>
                    
                    <!-- åˆ†å—ç­–ç•¥è§£é‡Š -->
                    <div class="deep-explanation">
                        <h4>ğŸ“ ä¸ºä»€ä¹ˆè¦åˆ†å—ï¼Ÿå¦‚ä½•åˆ†å—ï¼Ÿ</h4>
                        <div class="explanation-section">
                            <h5>ä¸ºä»€ä¹ˆåˆ†å—ï¼Ÿ</h5>
                            <ul>
                                <li>æ¨¡å‹è¾“å…¥é•¿åº¦é™åˆ¶ï¼ˆMiniLM-L6æœ€å¤§256 tokensï¼‰</li>
                                <li>æé«˜æœç´¢ç²¾åº¦ï¼ˆå°å—æ›´å®¹æ˜“åŒ¹é…ï¼‰</li>
                                <li>ä¼˜åŒ–å­˜å‚¨å’Œæ£€ç´¢æ•ˆç‡</li>
                            </ul>
                        </div>
                        <div class="explanation-section">
                            <h5>åˆ†å—ç­–ç•¥</h5>
                            <p><strong>å—å¤§å°ï¼š</strong>500å­—ç¬¦</p>
                            <p><strong>é‡å ï¼š</strong>100å­—ç¬¦</p>
                            <p><strong>åŸå› ï¼š</strong>ä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§</p>
                        </div>
                        <div class="code-block">
<span class="comment"># æ–‡æ¡£åˆ†å—å®ç°</span>
<span class="keyword">def</span> <span class="function">chunk_text</span>(text, chunk_size=<span class="number">500</span>, overlap=<span class="number">100</span>):
    chunks = []
    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(text), chunk_size - overlap):
        chunk = text[i:i + chunk_size]
        chunks.append(chunk)
    <span class="keyword">return</span> chunks

<span class="comment"># ç¤ºä¾‹</span>
text = <span class="string">"Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€..."</span> * <span class="number">100</span>
chunks = chunk_text(text)
<span class="keyword">print</span>(f<span class="string">"æ–‡æ¡£è¢«åˆ†æˆ {len(chunks)} å—"</span>)
                        </div>
                    </div>
                    
                    <!-- å‘é‡ç©ºé—´å¯è§†åŒ– -->
                    <div class="vector-space-container">
                        <h4>ğŸŒŒ å‘é‡ç©ºé—´å¯è§†åŒ–</h4>
                        <canvas id="vector-canvas" class="vector-canvas" width="600" height="400"></canvas>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                            çº¢ç‚¹ï¼šæŸ¥è¯¢å‘é‡ | è“ç‚¹ï¼šæ–‡æ¡£å‘é‡ | ç»¿çº¿ï¼šç›¸ä¼¼åº¦è¿æ¥
                        </p>
                        <div style="margin-top: 15px; padding: 15px; background: #e8f4ff; border-radius: 8px; border-left: 4px solid #007bff;">
                            <p style="margin: 0; font-size: 0.9em; color: #555;">
                                <strong>ğŸ’¡ æç¤ºï¼š</strong>è¿™æ˜¯384ç»´ç©ºé—´åœ¨2Då¹³é¢çš„æŠ•å½±æ¼”ç¤ºã€‚å®é™…å‘é‡è®¡ç®—åœ¨é«˜ç»´ç©ºé—´ä¸­è¿›è¡Œï¼Œå…·æœ‰æ›´å¼ºçš„è¯­ä¹‰è¡¨è¾¾èƒ½åŠ›ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- è¿è¡Œæ€å¯è§†åŒ– -->
                <div id="runtime-flow" class="flow-content" style="display: none;">
                    <svg class="pipeline-svg" viewBox="0 0 1000 800" style="width: 100%; height: 700px;">
                        <!-- å®Œæ•´çš„11æ­¥æµç¨‹ -->
                        
                        <!-- Step 1: ç”¨æˆ·è¾“å…¥ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('user-input')">
                            <rect x="50" y="50" width="120" height="60" rx="10" 
                                  class="flow-node clickable" id="user-input-node"/>
                            <text x="110" y="75" class="node-text">ğŸ” ç”¨æˆ·è¾“å…¥</text>
                            <text x="110" y="95" class="node-text" style="font-size: 14px;">æŸ¥è¯¢é—®é¢˜</text>
                        </g>
                        
                        <!-- Step 2: APIæ¥æ”¶ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('api-receive')">
                            <rect x="220" y="50" width="120" height="60" rx="10" 
                                  class="flow-node clickable" id="api-receive-node"/>
                            <text x="280" y="75" class="node-text">ğŸŒ APIæ¥æ”¶</text>
                            <text x="280" y="95" class="node-text" style="font-size: 14px;">FastAPI</text>
                        </g>
                        
                        <!-- Step 3: ä¼šè¯ç®¡ç† -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('session-mgmt')">
                            <rect x="390" y="50" width="120" height="60" rx="10" 
                                  class="flow-node clickable" id="session-mgmt-node"/>
                            <text x="450" y="75" class="node-text">ğŸ“‹ ä¼šè¯ç®¡ç†</text>
                            <text x="450" y="95" class="node-text" style="font-size: 14px;">ä¸Šä¸‹æ–‡</text>
                        </g>
                        
                        <!-- Step 4: å·¥å…·å‡†å¤‡ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('tool-prep')">
                            <rect x="560" y="50" width="120" height="60" rx="10" 
                                  class="flow-node clickable" id="tool-prep-node"/>
                            <text x="620" y="75" class="node-text">ğŸ”§ å·¥å…·å‡†å¤‡</text>
                            <text x="620" y="95" class="node-text" style="font-size: 14px;">æ ¼å¼è½¬æ¢</text>
                        </g>
                        
                        <!-- Step 5: è·¯ç”±å†³ç­– (æ ¸å¿ƒ) -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('router-decision')">
                            <rect x="350" y="180" width="180" height="70" rx="10" 
                                  class="flow-node clickable" id="router-decision-node"
                                  style="fill: #fff3cd; stroke: #ffc107; stroke-width: 3;"/>
                            <text x="440" y="210" class="node-text" style="font-weight: bold;">ğŸš¦ è·¯ç”±å†³ç­–</text>
                            <text x="440" y="230" class="node-text" style="font-size: 14px;">æ™ºèƒ½åˆ¤æ–­</text>
                        </g>
                        
                        <!-- å·¦åˆ†æ”¯: å·¥å…·è°ƒç”¨è·¯å¾„ -->
                        <!-- Step 6: V3æ¨¡å‹ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('model-v3')">
                            <rect x="150" y="320" width="140" height="60" rx="10" 
                                  class="flow-node clickable" id="model-v3-node"
                                  style="fill: #e8f5e8; stroke: #28a745;"/>
                            <text x="220" y="345" class="node-text">ğŸ”§ DeepSeek-V3</text>
                            <text x="220" y="365" class="node-text" style="font-size: 14px;">å·¥å…·è°ƒç”¨</text>
                        </g>
                        
                        <!-- Step 7: å·¥å…·è°ƒç”¨ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('tool-call')">
                            <rect x="150" y="420" width="140" height="60" rx="10" 
                                  class="flow-node clickable" id="tool-call-node"/>
                            <text x="220" y="445" class="node-text">ğŸ› ï¸ å·¥å…·è°ƒç”¨</text>
                            <text x="220" y="465" class="node-text" style="font-size: 14px;">search_course</text>
                        </g>
                        
                        <!-- Step 8: å‘é‡æœç´¢ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('vector-search')">
                            <rect x="150" y="520" width="140" height="60" rx="10" 
                                  class="flow-node clickable" id="vector-search-node"/>
                            <text x="220" y="545" class="node-text">ğŸ” å‘é‡æœç´¢</text>
                            <text x="220" y="565" class="node-text" style="font-size: 14px;">ChromaDB</text>
                        </g>
                        
                        <!-- å³åˆ†æ”¯: ç›´æ¥æ¨ç†è·¯å¾„ -->
                        <!-- R1ç›´æ¥å¤„ç† -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('model-r1-direct')">
                            <rect x="590" y="320" width="140" height="60" rx="10" 
                                  class="flow-node clickable" id="model-r1-direct-node"
                                  style="fill: #ffe8e8; stroke: #dc3545;"/>
                            <text x="660" y="345" class="node-text">ğŸ§  DeepSeek-R1</text>
                            <text x="660" y="365" class="node-text" style="font-size: 14px;">ç›´æ¥æ¨ç†</text>
                        </g>
                        
                        <!-- Step 9: æ¨¡å‹åˆ‡æ¢ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('model-switch')">
                            <rect x="350" y="420" width="180" height="60" rx="10" 
                                  class="flow-node clickable" id="model-switch-node"
                                  style="fill: #f0f4ff; stroke: #667eea; stroke-width: 2;"/>
                            <text x="440" y="445" class="node-text">ğŸ”„ æ¨¡å‹åˆ‡æ¢</text>
                            <text x="440" y="465" class="node-text" style="font-size: 14px;">V3 â†’ R1</text>
                        </g>
                        
                        <!-- Step 10: ç»“æœæ•´åˆ -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('result-integrate')">
                            <rect x="350" y="520" width="180" height="60" rx="10" 
                                  class="flow-node clickable" id="result-integrate-node"
                                  style="fill: #ffe8e8; stroke: #dc3545;"/>
                            <text x="440" y="545" class="node-text">ğŸ§© ç»“æœæ•´åˆ</text>
                            <text x="440" y="565" class="node-text" style="font-size: 14px;">R1å¤„ç†</text>
                        </g>
                        
                        <!-- Step 11: æœ€ç»ˆå“åº” -->
                        <g class="node-group" onclick="showRuntimeNodeDetail('final-response')">
                            <rect x="350" y="620" width="180" height="60" rx="10" 
                                  class="flow-node clickable" id="final-response-node"
                                  style="fill: #d4edda; stroke: #28a745; stroke-width: 3;"/>
                            <text x="440" y="645" class="node-text" style="font-weight: bold;">ğŸ“¤ æœ€ç»ˆå“åº”</text>
                            <text x="440" y="665" class="node-text" style="font-size: 14px;">è¿”å›ç­”æ¡ˆ</text>
                        </g>
                        
                        <!-- è¿æ¥çº¿ - ä¸»æµç¨‹ -->
                        <path d="M170,80 L220,80" class="pipeline-path"/>
                        <path d="M340,80 L390,80" class="pipeline-path"/>
                        <path d="M510,80 L560,80" class="pipeline-path"/>
                        <path d="M620,110 L620,150 L440,150 L440,180" class="pipeline-path"/>
                        
                        <!-- å·¦åˆ†æ”¯è¿çº¿ (å·¥å…·è·¯å¾„) -->
                        <path d="M350,215 L220,215 L220,320" class="pipeline-path" id="tool-path"
                              style="stroke: #28a745; stroke-dasharray: 10,5;"/>
                        <path d="M220,380 L220,420" class="pipeline-path" style="stroke: #28a745;"/>
                        <path d="M220,480 L220,520" class="pipeline-path" style="stroke: #28a745;"/>
                        <path d="M290,550 L350,550" class="pipeline-path" style="stroke: #28a745;"/>
                        
                        <!-- å³åˆ†æ”¯è¿çº¿ (ç›´æ¥è·¯å¾„) -->
                        <path d="M530,215 L660,215 L660,320" class="pipeline-path" id="direct-path"
                              style="stroke: #dc3545; stroke-dasharray: 10,5;"/>
                        <path d="M660,380 L660,450 L530,450" class="pipeline-path" style="stroke: #dc3545;"/>
                        
                        <!-- æ¨¡å‹åˆ‡æ¢è¿çº¿ -->
                        <path d="M290,350 L350,350 L350,420" class="pipeline-path" 
                              style="stroke: #667eea; stroke-width: 2;"/>
                        <path d="M440,480 L440,520" class="pipeline-path" style="stroke: #dc3545;"/>
                        <path d="M440,580 L440,620" class="pipeline-path" style="stroke: #28a745;"/>
                        
                        <!-- æ ‡æ³¨æ–‡å­— -->
                        <text x="250" y="200" style="fill: #28a745; font-size: 12px;">éœ€è¦æœç´¢</text>
                        <text x="550" y="200" style="fill: #dc3545; font-size: 12px;">ç›´æ¥å›ç­”</text>
                        <text x="320" y="400" style="fill: #667eea; font-size: 12px;">åˆ‡æ¢æ¨¡å‹</text>
                        
                        <!-- ç‚¹å‡»æç¤º -->
                        <text x="500" y="750" style="fill: #667eea; font-size: 14px; text-anchor: middle;">
                            ğŸ’¡ ç‚¹å‡»ä»»æ„èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                        </text>
                    </svg>
                    
                    <!-- V2.0åŒæ¨¡å‹æ¶æ„è§£é‡Š -->
                    <div class="deep-explanation">
                        <h4>ğŸš€ V2.0åŒæ¨¡å‹æ™ºèƒ½è·¯ç”±æ¶æ„</h4>
                        <div class="explanation-section">
                            <h5>ğŸ¤– DeepSeek-V3ï¼šå·¥å…·è°ƒç”¨ä¸“å®¶</h5>
                            <p>ä¸“é—¨å¤„ç†éœ€è¦è°ƒç”¨æœç´¢ã€æ•°æ®åº“ç­‰å·¥å…·çš„ä»»åŠ¡</p>
                        </div>
                        <div class="explanation-section">
                            <h5>ğŸ§  DeepSeek-R1ï¼šæ¨ç†åˆ†æä¸“å®¶</h5>
                            <p>ä¸“é—¨å¤„ç†éœ€è¦æ·±åº¦æ€è€ƒå’Œé€»è¾‘æ¨ç†çš„ä»»åŠ¡</p>
                        </div>
                        <div class="explanation-section">
                            <h5>ğŸš¦ æ™ºèƒ½è·¯ç”±å†³ç­–</h5>
                            <p>æ ¹æ®æŸ¥è¯¢ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ä¿¡æ¯é¢æ¿ -->
            <div class="info-panel">
                <div class="info-tabs">
                    <button class="info-tab active" onclick="switchInfoTab('concept')">
                        ğŸ“š æ¦‚å¿µåŸç†
                    </button>
                    <button class="info-tab" onclick="switchInfoTab('code')">
                        ğŸ’» ä»£ç å®ç°
                    </button>
                    <button class="info-tab" onclick="switchInfoTab('runtime')">
                        ğŸš€ è¿è¡ŒçŠ¶æ€
                    </button>
                </div>

                <!-- æ¦‚å¿µåŸç†æ ‡ç­¾é¡µ -->
                <div id="concept-tab" class="tab-content active">
                    <div id="dynamic-content">
                        <h3>ğŸ“š æ ¸å¿ƒæ¦‚å¿µ <span id="current-state" class="state-indicator dev">å¼€å‘æ€</span></h3>
                        <div id="selected-node-info">
                            <p style="color: #666; text-align: center; padding: 20px;">
                                ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                            </p>
                        </div>
                    <div class="learning-card" id="right-panel-knowledge-card" style="display: none;">
                        <h4 id="right-knowledge-title">ç³»ç»Ÿå¯¹æ¯”åˆ†æ</h4>
                        <div id="right-knowledge-content">
                            <!-- Content will be populated dynamically based on current mode -->
                        </div>
                    </div>
                    
                    </div>
                </div>

                <!-- ä»£ç å®ç°æ ‡ç­¾é¡µ -->
                <div id="code-tab" class="tab-content">
                    <h3>ğŸ’» ä»£ç å®ç° <span id="current-state-code" class="state-indicator dev">å¼€å‘æ€</span></h3>
                    <div id="code-display">
                        <p style="color: #666; text-align: center; padding: 20px;">
                            ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹å¯¹åº”ä»£ç 
                        </p>
                    </div>
                </div>

                <!-- è¿è¡ŒçŠ¶æ€æ ‡ç­¾é¡µ -->
                <div id="runtime-tab" class="tab-content">
                    <h3>ğŸš€ è¿è¡ŒçŠ¶æ€ <span id="current-state-runtime" class="state-indicator dev">å¼€å‘æ€</span></h3>
                    <div id="runtime-display">
                        <div id="node-runtime-info">
                            <p style="color: #666; text-align: center; padding: 20px;">
                                ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
                            </p>
                        </div>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-value">ğŸŸ¢</div>
                                <div class="metric-label">ç³»ç»ŸçŠ¶æ€</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">0ms</div>
                                <div class="metric-label">å“åº”æ—¶é—´</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">0MB</div>
                                <div class="metric-label">å†…å­˜ä½¿ç”¨</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">0%</div>
                                <div class="metric-label">CPUä½¿ç”¨</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <h4 style="color: #2a5298; margin-bottom: 10px;">ğŸ“ è¿è¡Œæ—¥å¿—</h4>
                            <div id="runtime-log" style="font-family: monospace; font-size: 0.9em; color: #666;">
                                [ç³»ç»Ÿ] ç­‰å¾…æ“ä½œ...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- æç¤ºæ¡† -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // å…¨å±€çŠ¶æ€ç®¡ç†
        let currentMode = 'dev';
        let isProcessing = false;
        let currentStep = 0;
        
        // èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ•°æ®
        const nodeDetails = {
            'config': {
                title: 'ğŸ“„ ç¯å¢ƒé…ç½®',
                concept: {
                    why: 'ç³»ç»Ÿéœ€è¦çŸ¥é“å¦‚ä½•è¿æ¥å„ä¸ªæœåŠ¡å’ŒAPI',
                    what: 'ä».envæ–‡ä»¶è¯»å–é…ç½®å‚æ•°',
                    how: 'ä½¿ç”¨python-dotenvåº“åŠ è½½ç¯å¢ƒå˜é‡'
                },
                code: `<span class="comment"># backend/config.py</span>
<span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseSettings

<span class="keyword">class</span> <span class="function">Config</span>(BaseSettings):
    <span class="comment"># AIæ¨¡å‹é…ç½®</span>
    LLM_PROVIDER: str = <span class="string">"deepseek"</span>
    LLM_API_KEY: str
    LLM_BASE_URL: str
    
    <span class="comment"># åŒæ¨¡å‹é…ç½®</span>
    MODEL_REASON: str = <span class="string">"DeepSeek-R1"</span>
    MODEL_TOOLCALL: str = <span class="string">"DeepSeek-V3"</span>
    
    <span class="comment"># å‘é‡æ•°æ®åº“é…ç½®</span>
    CHROMA_PATH: str = <span class="string">"./chroma_db"</span>
    EMBEDDING_MODEL: str = <span class="string">"all-MiniLM-L6-v2"</span>
    
    <span class="keyword">class</span> Config:
        env_file = <span class="string">".env"</span>`,
                runtime: {
                    status: 'å·²åŠ è½½',
                    configs: {
                        'APIæä¾›å•†': 'DeepSeek',
                        'å‘é‡æ•°æ®åº“': 'ChromaDB',
                        'åµŒå…¥æ¨¡å‹': 'MiniLM-L6'
                    }
                }
            },
            'vectordb': {
                title: 'ğŸ—„ï¸ å‘é‡æ•°æ®åº“',
                concept: {
                    why: 'ä¼ ç»Ÿæ•°æ®åº“æ— æ³•ç†è§£"Python"å’Œ"æ´¾æ£®"æ˜¯åŒä¸€ä¸ªæ„æ€',
                    what: 'ChromaDBæ˜¯ä¸“é—¨å­˜å‚¨å’Œæ£€ç´¢å‘é‡çš„æ•°æ®åº“',
                    how: 'é€šè¿‡è®¡ç®—å‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦æ‰¾åˆ°è¯­ä¹‰ç›¸è¿‘çš„å†…å®¹'
                },
                code: `<span class="comment"># backend/vector_store.py</span>
<span class="keyword">import</span> chromadb
<span class="keyword">from</span> chromadb.config <span class="keyword">import</span> Settings

<span class="keyword">class</span> <span class="function">VectorStore</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, chroma_path: str):
        <span class="comment"># åˆå§‹åŒ–ChromaDBå®¢æˆ·ç«¯</span>
        self.client = chromadb.PersistentClient(
            path=chroma_path,
            settings=Settings(anonymized_telemetry=<span class="keyword">False</span>)
        )
        
    <span class="keyword">def</span> <span class="function">search</span>(self, query: str, k: int = <span class="number">5</span>):
        <span class="comment"># å°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡</span>
        query_vector = self.embed(query)
        
        <span class="comment"># ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢</span>
        results = self.collection.query(
            query_embeddings=[query_vector],
            n_results=k
        )
        <span class="keyword">return</span> results`,
                runtime: {
                    status: 'è¿è¡Œä¸­',
                    metrics: {
                        'å­˜å‚¨æ–‡æ¡£': 1250,
                        'å‘é‡ç»´åº¦': 384,
                        'æŸ¥è¯¢å»¶è¿Ÿ': '45ms'
                    }
                }
            },
            'embedding': {
                title: 'ğŸ”¢ åµŒå…¥æ¨¡å‹',
                concept: {
                    why: 'è®¡ç®—æœºä¸èƒ½ç›´æ¥ç†è§£æ–‡å­—ï¼Œéœ€è¦è½¬æ¢æˆæ•°å­—',
                    what: 'MiniLM-L6å°†æ–‡æœ¬è½¬æ¢ä¸º384ç»´å‘é‡',
                    how: 'é€šè¿‡æ·±åº¦å­¦ä¹ æ¨¡å‹ç¼–ç è¯­ä¹‰ä¿¡æ¯'
                },
                code: `<span class="comment"># ä¸ºä»€ä¹ˆé€‰æ‹©MiniLM-L6ï¼Ÿ</span>
<span class="comment"># 1. æ¨¡å‹å°å·§ï¼šä»…25MBï¼ˆBERTéœ€è¦420MBï¼‰</span>
<span class="comment"># 2. é€Ÿåº¦å¿«ï¼šæ¨ç†é€Ÿåº¦æ˜¯BERTçš„5å€</span>
<span class="comment"># 3. å¤šè¯­è¨€ï¼šæ”¯æŒä¸­è‹±æ–‡ç­‰å¤šç§è¯­è¨€</span>
<span class="comment"># 4. æ•ˆæœå¥½ï¼šåœ¨è¯­ä¹‰ç›¸ä¼¼åº¦ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜ç§€</span>

<span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer

<span class="comment"># åŠ è½½æ¨¡å‹</span>
model = SentenceTransformer(<span class="string">'all-MiniLM-L6-v2'</span>)

<span class="comment"># æ–‡æœ¬è½¬å‘é‡ç¤ºä¾‹</span>
texts = [
    <span class="string">"Pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€"</span>,
    <span class="string">"æ´¾æ£®æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€"</span>,
    <span class="string">"Javaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€"</span>
]

vectors = model.encode(texts)
<span class="comment"># vectors.shape = (3, 384)</span>

<span class="comment"># è®¡ç®—ç›¸ä¼¼åº¦</span>
<span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity
sim_matrix = cosine_similarity(vectors)
<span class="comment"># Python vs æ´¾æ£®: 0.95 (é«˜ç›¸ä¼¼åº¦)</span>
<span class="comment"># Python vs Java: 0.72 (ä¸­ç­‰ç›¸ä¼¼åº¦)</span>`,
                runtime: {
                    status: 'å·²åŠ è½½',
                    metrics: {
                        'æ¨¡å‹å¤§å°': '25MB',
                        'å‘é‡ç»´åº¦': 384,
                        'ç¼–ç é€Ÿåº¦': '1000å¥/ç§’'
                    }
                }
            },
            'ai-config': {
                title: 'ğŸ¤– AIæ¨¡å‹é…ç½®',
                concept: {
                    why: 'ä¸åŒä»»åŠ¡éœ€è¦ä¸åŒèƒ½åŠ›çš„æ¨¡å‹',
                    what: 'DeepSeekåŒæ¨¡å‹æ¶æ„ï¼šV3å¤„ç†å·¥å…·è°ƒç”¨ï¼ŒR1å¤„ç†æ¨ç†',
                    how: 'æ ¹æ®ä»»åŠ¡ç±»å‹æ™ºèƒ½è·¯ç”±åˆ°åˆé€‚çš„æ¨¡å‹'
                },
                code: `<span class="comment"># backend/ai_generator.py</span>
<span class="keyword">class</span> <span class="function">AIGenerator</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        <span class="comment"># åŒæ¨¡å‹é…ç½®</span>
        self.model_reason = <span class="string">"DeepSeek-R1"</span>  <span class="comment"># æ¨ç†ä¸“ç”¨</span>
        self.model_toolcall = <span class="string">"DeepSeek-V3"</span>  <span class="comment"># å·¥å…·è°ƒç”¨ä¸“ç”¨</span>
        
    <span class="keyword">def</span> <span class="function">route_query</span>(self, query: str, has_tools: bool):
        <span class="comment"># æ™ºèƒ½è·¯ç”±å†³ç­–</span>
        <span class="keyword">if</span> has_tools and self._needs_search(query):
            <span class="comment"># éœ€è¦æœç´¢è¯¾ç¨‹å†…å®¹</span>
            <span class="keyword">return</span> self.model_toolcall  <span class="comment"># ä½¿ç”¨V3</span>
        <span class="keyword">else</span>:
            <span class="comment"># ä¸€èˆ¬çŸ¥è¯†é—®ç­”</span>
            <span class="keyword">return</span> self.model_reason  <span class="comment"># ä½¿ç”¨R1</span>
            
    <span class="keyword">def</span> <span class="function">_needs_search</span>(self, query: str):
        <span class="comment"># åˆ¤æ–­æ˜¯å¦éœ€è¦æœç´¢</span>
        keywords = [<span class="string">"è¯¾ç¨‹"</span>, <span class="string">"ç« èŠ‚"</span>, <span class="string">"å†…å®¹"</span>, <span class="string">"å­¦ä¹ "</span>]
        <span class="keyword">return</span> any(kw <span class="keyword">in</span> query <span class="keyword">for</span> kw <span class="keyword">in</span> keywords)`,
                runtime: {
                    status: 'å·²é…ç½®',
                    metrics: {
                        'R1æ¨¡å‹': 'æ¨ç†ä»»åŠ¡',
                        'V3æ¨¡å‹': 'å·¥å…·è°ƒç”¨',
                        'é™çº§æ–¹æ¡ˆ': 'Claude API'
                    }
                }
            },
            'router': {
                title: 'ğŸš¦ æ™ºèƒ½è·¯ç”±å™¨',
                concept: {
                    why: 'ä¸åŒæŸ¥è¯¢éœ€è¦ä¸åŒçš„å¤„ç†ç­–ç•¥',
                    what: 'åˆ†ææŸ¥è¯¢æ„å›¾ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å¤„ç†è·¯å¾„',
                    how: 'åŸºäºè§„åˆ™å’Œæ¨¡å¼åŒ¹é…è¿›è¡Œå†³ç­–'
                },
                code: `<span class="comment"># è·¯ç”±å†³ç­–æ ‘</span>
<span class="keyword">def</span> <span class="function">intelligent_routing</span>(query: str, context: dict):
    <span class="comment">"""
    æ™ºèƒ½è·¯ç”±å†³ç­–æµç¨‹
    
    å†³ç­–å› ç´ ï¼š
    1. æŸ¥è¯¢ç±»å‹ï¼ˆè¯¾ç¨‹å†…å®¹ vs é€šç”¨çŸ¥è¯†ï¼‰
    2. æ˜¯å¦éœ€è¦å·¥å…·è°ƒç”¨
    3. ä¸Šä¸‹æ–‡ä¿¡æ¯
    4. ç³»ç»Ÿè´Ÿè½½
    """</span>
    
    <span class="comment"># Step 1: åˆ†ææŸ¥è¯¢ç±»å‹</span>
    query_type = analyze_query(query)
    
    <span class="comment"># Step 2: å†³ç­–è·¯ç”±</span>
    <span class="keyword">if</span> query_type == <span class="string">"course_content"</span>:
        <span class="comment"># éœ€è¦æœç´¢è¯¾ç¨‹ææ–™</span>
        model = <span class="string">"DeepSeek-V3"</span>
        tools = [<span class="string">"search_course"</span>]
        path = <span class="string">"tool_calling_path"</span>
    <span class="keyword">elif</span> query_type == <span class="string">"general_knowledge"</span>:
        <span class="comment"># é€šç”¨çŸ¥è¯†é—®ç­”</span>
        model = <span class="string">"DeepSeek-R1"</span>
        tools = []
        path = <span class="string">"direct_reasoning_path"</span>
    <span class="keyword">else</span>:
        <span class="comment"># æ··åˆå‹æŸ¥è¯¢</span>
        model = <span class="string">"DeepSeek-V3"</span>
        tools = [<span class="string">"search_course"</span>]
        path = <span class="string">"hybrid_path"</span>
        
    <span class="keyword">return</span> {
        <span class="string">"model"</span>: model,
        <span class="string">"tools"</span>: tools,
        <span class="string">"path"</span>: path
    }`,
                runtime: {
                    status: 'å°±ç»ª',
                    metrics: {
                        'è·¯ç”±ç­–ç•¥': 'åŸºäºä»»åŠ¡',
                        'æ¨¡å‹æ± ': 2,
                        'é™çº§æ”¯æŒ': 'æ˜¯'
                    }
                }
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initializeVectorVisualization();
            addTooltips();
            updateMetrics();
            
            // åˆå§‹åŒ–çŸ¥è¯†å¡ç‰‡ï¼ˆé»˜è®¤å¼€å‘æ€ï¼‰
            updateLeftPanelKnowledgeCard('dev');
            updateRightPanelKnowledgeCard('dev');
        });

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode, event) {
            if (isProcessing) return;
            
            currentMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // å¤„ç†äº‹ä»¶å¯¹è±¡
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            } else {
                // æ²¡æœ‰äº‹ä»¶æ—¶ï¼Œæ ¹æ®modeæ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®
                const modeMap = {
                    'dev': 0,
                    'manage': 1,
                    'runtime': 2
                };
                const btns = document.querySelectorAll('.mode-btn');
                if (btns[modeMap[mode]]) {
                    btns[modeMap[mode]].classList.add('active');
                }
            }
            
            // æ›´æ–°æµç¨‹å›¾
            document.querySelectorAll('.flow-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(mode + '-flow').style.display = 'block';
            
            // æ›´æ–°æ ‡é¢˜
            const titles = {
                'dev': 'ğŸ› ï¸ å¼€å‘æ€ - ç³»ç»Ÿåˆå§‹åŒ–',
                'manage': 'ğŸ“‹ ç®¡ç†æ€ - æ–‡æ¡£å¤„ç†',
                'runtime': 'ğŸš€ è¿è¡Œæ€ - æŸ¥è¯¢å¤„ç†'
            };
            document.getElementById('stage-title').textContent = titles[mode];
            
            // æ›´æ–°å³ä¾§é¢æ¿çŠ¶æ€æŒ‡ç¤ºå™¨
            updateStateIndicators(mode);
            
            // æ›´æ–°å·¦ä¾§é¢æ¿çŸ¥è¯†å¡ç‰‡
            updateLeftPanelKnowledgeCard(mode);
            
            // æ›´æ–°å³ä¾§é¢æ¿çŸ¥è¯†å¡ç‰‡
            updateRightPanelKnowledgeCard(mode);
            
            // æ˜¾ç¤ºå³ä¾§çŸ¥è¯†å¡ç‰‡
            const rightKnowledgeCard = document.getElementById('right-panel-knowledge-card');
            if (rightKnowledgeCard) {
                rightKnowledgeCard.style.display = 'block';
            }
            
            // é‡ç½®èŠ‚ç‚¹çŠ¶æ€å’Œé€‰æ‹©
            resetNodes();
            clearNodeSelection();
            
            // æ·»åŠ æ—¥å¿—
            addLog(`åˆ‡æ¢åˆ°${titles[mode]}`);
        }
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStateIndicators(mode) {
            const stateNames = {
                'dev': 'å¼€å‘æ€',
                'manage': 'ç®¡ç†æ€',
                'runtime': 'è¿è¡Œæ€'
            };
            
            const indicators = [
                'current-state',
                'current-state-code', 
                'current-state-runtime'
            ];
            
            indicators.forEach(id => {
                const indicator = document.getElementById(id);
                if (indicator) {
                    indicator.textContent = stateNames[mode];
                    indicator.className = `state-indicator ${mode}`;
                }
            });
        }
        
        // æ›´æ–°å·¦ä¾§é¢æ¿çŸ¥è¯†å¡ç‰‡
        function updateLeftPanelKnowledgeCard(mode) {
            const learningCard = document.getElementById('context-learning-card');
            const cardTitle = document.getElementById('learning-card-title');
            const cardContent = document.getElementById('learning-card-content');
            
            if (!learningCard || !cardTitle || !cardContent) return;
            
            const cardConfigs = {
                'dev': {
                    title: 'ğŸ› ï¸ å¼€å‘æ€é…ç½®è¦ç‚¹',
                    content: `
                        <div class="concept-box">
                            <strong>ç¯å¢ƒé…ç½®ï¼š</strong>
                            ç¡®ä¿APIå¯†é’¥æ­£ç¡®é…ç½®ï¼Œæ¨¡å‹æœåŠ¡å¯ç”¨
                        </div>
                        <div class="concept-box">
                            <strong>ä¾èµ–æ£€æŸ¥ï¼š</strong>
                            éªŒè¯ChromaDBã€å‘é‡æ¨¡å‹ç­‰ç»„ä»¶çŠ¶æ€
                        </div>
                        <div class="analogy-box">
                            <h5>ğŸ’¡ å¼€å‘æç¤º</h5>
                            <div class="analogy-item">
                                <span class="icon">ğŸ”§</span>
                                <span>å…ˆé…ç½®ç¯å¢ƒï¼Œå†å¯åŠ¨æœåŠ¡</span>
                            </div>
                            <div class="analogy-item">
                                <span class="icon">ğŸ“</span>
                                <span>æ£€æŸ¥æ—¥å¿—ç¡®è®¤ç»„ä»¶æ­£å¸¸</span>
                            </div>
                        </div>
                    `
                },
                'manage': {
                    title: 'ğŸ“‹ ç®¡ç†æ€å¤„ç†æŠ€å·§',
                    content: `
                        <div class="concept-box">
                            <strong>æ–‡æ¡£å‡†å¤‡ï¼š</strong>
                            æ”¯æŒMDã€PDFã€TXTç­‰æ ¼å¼ï¼Œå»ºè®®é¢„å¤„ç†
                        </div>
                        <div class="concept-box">
                            <strong>åˆ†å—ç­–ç•¥ï¼š</strong>
                            500å­—ç¬¦/å—ï¼Œ100å­—ç¬¦é‡å ä¿è¯è¿è´¯æ€§
                        </div>
                        <div class="analogy-box">
                            <h5>ğŸ’¡ å¤„ç†å»ºè®®</h5>
                            <div class="analogy-item">
                                <span class="icon">ğŸ“„</span>
                                <span>æ–‡æ¡£è´¨é‡å½±å“æœç´¢æ•ˆæœ</span>
                            </div>
                            <div class="analogy-item">
                                <span class="icon">âœ‚ï¸</span>
                                <span>åˆç†åˆ†å—æé«˜åŒ¹é…ç²¾åº¦</span>
                            </div>
                        </div>
                    `
                },
                'runtime': {
                    title: 'ğŸš€ è¿è¡Œæ€æŸ¥è¯¢ä¼˜åŒ–',
                    content: `
                        <div class="concept-box">
                            <strong>æŸ¥è¯¢æŠ€å·§ï¼š</strong>
                            ä½¿ç”¨å…·ä½“å…³é”®è¯ï¼Œé¿å…è¿‡äºå®½æ³›çš„é—®é¢˜
                        </div>
                        <div class="concept-box">
                            <strong>åŒæ¨¡å‹ä¼˜åŠ¿ï¼š</strong>
                            V3å¤„ç†å·¥å…·è°ƒç”¨ï¼ŒR1ä¸“æ”»æ¨ç†åˆ†æ
                        </div>
                        <div class="analogy-box">
                            <h5>ğŸ’¡ æŸ¥è¯¢å»ºè®®</h5>
                            <div class="analogy-item">
                                <span class="icon">ğŸ¯</span>
                                <span>æ˜ç¡®é—®é¢˜å¾—åˆ°ç²¾å‡†ç­”æ¡ˆ</span>
                            </div>
                            <div class="analogy-item">
                                <span class="icon">ğŸ”„</span>
                                <span>æ™ºèƒ½è·¯ç”±è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å‹</span>
                            </div>
                        </div>
                    `
                }
            };
            
            const config = cardConfigs[mode];
            if (config) {
                cardTitle.textContent = config.title;
                cardContent.innerHTML = config.content;
            }
        }
        
        // æ›´æ–°å³ä¾§é¢æ¿çŸ¥è¯†å¡ç‰‡
        function updateRightPanelKnowledgeCard(mode) {
            const knowledgeCard = document.getElementById('right-panel-knowledge-card');
            const cardTitle = document.getElementById('right-knowledge-title');
            const cardContent = document.getElementById('right-knowledge-content');
            
            if (!knowledgeCard || !cardTitle || !cardContent) return;
            
            const cardConfigs = {
                'dev': {
                    title: 'ç³»ç»Ÿæ¶æ„å¯¹æ¯”',
                    content: `
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>ç»„ä»¶</th>
                                    <th>ä¼ ç»Ÿæ–¹æ¡ˆ</th>
                                    <th>RAGæ–¹æ¡ˆ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>å­˜å‚¨</td>
                                    <td>å…³ç³»æ•°æ®åº“</td>
                                    <td>å‘é‡æ•°æ®åº“</td>
                                </tr>
                                <tr>
                                    <td>æœç´¢</td>
                                    <td>å…³é”®è¯åŒ¹é…</td>
                                    <td>è¯­ä¹‰ç›¸ä¼¼åº¦</td>
                                </tr>
                                <tr>
                                    <td>ç†è§£</td>
                                    <td>å­—é¢åŒ¹é…</td>
                                    <td>ä¸Šä¸‹æ–‡ç†è§£</td>
                                </tr>
                                <tr>
                                    <td>æ‰©å±•æ€§</td>
                                    <td>éœ€ä¿®æ”¹ä»£ç </td>
                                    <td>åŠ¨æ€å­¦ä¹ </td>
                                </tr>
                            </tbody>
                        </table>
                    `
                },
                'manage': {
                    title: 'æ–‡æ¡£å¤„ç†æµç¨‹',
                    content: `
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>æ­¥éª¤</th>
                                    <th>è¾“å…¥</th>
                                    <th>è¾“å‡º</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>æ–‡æ¡£è¾“å…¥</td>
                                    <td>åŸå§‹æ–‡æ¡£</td>
                                    <td>æ–‡ä»¶æµ</td>
                                </tr>
                                <tr>
                                    <td>æ ¼å¼è§£æ</td>
                                    <td>æ–‡ä»¶æµ</td>
                                    <td>çº¯æ–‡æœ¬</td>
                                </tr>
                                <tr>
                                    <td>æ–‡æœ¬åˆ†å—</td>
                                    <td>é•¿æ–‡æœ¬</td>
                                    <td>æ–‡æœ¬å—æ•°ç»„</td>
                                </tr>
                                <tr>
                                    <td>å‘é‡åŒ–</td>
                                    <td>æ–‡æœ¬å—</td>
                                    <td>384ç»´å‘é‡</td>
                                </tr>
                                <tr>
                                    <td>å­˜å‚¨</td>
                                    <td>å‘é‡+å…ƒæ•°æ®</td>
                                    <td>å¯æœç´¢ç´¢å¼•</td>
                                </tr>
                            </tbody>
                        </table>
                    `
                },
                'runtime': {
                    title: 'åŒæ¨¡å‹å¤„ç†å¯¹æ¯”',
                    content: `
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>ç‰¹æ€§</th>
                                    <th>DeepSeek-V3</th>
                                    <th>DeepSeek-R1</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ä¸“é•¿</td>
                                    <td>å·¥å…·è°ƒç”¨</td>
                                    <td>æ·±åº¦æ¨ç†</td>
                                </tr>
                                <tr>
                                    <td>ä½¿ç”¨åœºæ™¯</td>
                                    <td>éœ€è¦æœç´¢æ—¶</td>
                                    <td>åˆ†ææ€»ç»“æ—¶</td>
                                </tr>
                                <tr>
                                    <td>å“åº”é€Ÿåº¦</td>
                                    <td>å¿«é€Ÿ</td>
                                    <td>æ·±åº¦æ€è€ƒ</td>
                                </tr>
                                <tr>
                                    <td>è¾“å‡ºè´¨é‡</td>
                                    <td>ç²¾å‡†å·¥å…·æ‰§è¡Œ</td>
                                    <td>é€»è¾‘æ¨ç†</td>
                                </tr>
                            </tbody>
                        </table>
                    `
                }
            };
            
            const config = cardConfigs[mode];
            if (config) {
                cardTitle.textContent = config.title;
                cardContent.innerHTML = config.content;
            }
        }

        // åˆ‡æ¢ä¿¡æ¯é¢æ¿æ ‡ç­¾
        function switchInfoTab(tab) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            if (event) {
                event.stopPropagation();
            }
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.info-tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // æ‰¾åˆ°è¢«ç‚¹å‡»çš„æ ‡ç­¾æŒ‰é’®å¹¶æ¿€æ´»
            const clickedTab = document.querySelector(`[onclick="switchInfoTab('${tab}')"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + '-tab').classList.add('active');
        }

        // å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹
        let currentSelectedNode = null;
        
        // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦æƒ… - æ›´æ–°å³ä¾§é¢æ¿
        function showNodeDetail(nodeId, customDetail = null) {
            const detail = customDetail || nodeDetails[nodeId];
            if (!detail) return;
            
            // ç§»é™¤ä¹‹å‰é€‰ä¸­èŠ‚ç‚¹çš„é«˜äº®
            if (currentSelectedNode) {
                const prevNode = document.getElementById(currentSelectedNode + '-node');
                if (prevNode) {
                    prevNode.classList.remove('node-selected');
                }
            }
            
            // é«˜äº®å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹
            const currentNode = document.getElementById(nodeId + '-node');
            if (currentNode) {
                currentNode.classList.add('node-selected');
            }
            currentSelectedNode = nodeId;
            
            // æ›´æ–°å³ä¾§é¢æ¿å†…å®¹
            updateRightPanel(detail);
        }
        
        // æ›´æ–°å³ä¾§é¢æ¿å†…å®¹
        function updateRightPanel(detail) {
            // æ›´æ–°æ¦‚å¿µåŸç†æ ‡ç­¾é¡µ
            const conceptInfo = document.getElementById('selected-node-info');
            if (conceptInfo) {
                conceptInfo.innerHTML = `
                    <div class="panel-section">
                        <h4>${detail.title}</h4>
                        <div class="concept-box">
                            <strong>Whyï¼ˆä¸ºä»€ä¹ˆï¼‰ï¼š</strong>
                            ${detail.concept.why}
                        </div>
                        <div class="concept-box">
                            <strong>Whatï¼ˆæ˜¯ä»€ä¹ˆï¼‰ï¼š</strong>
                            ${detail.concept.what}
                        </div>
                        <div class="concept-box">
                            <strong>Howï¼ˆæ€ä¹ˆåšï¼‰ï¼š</strong>
                            ${detail.concept.how}
                        </div>
                    </div>
                `;
            }
            
            // éšè—å³ä¾§çŸ¥è¯†å¡ç‰‡ï¼Œçªå‡ºæ˜¾ç¤ºèŠ‚ç‚¹ç‰¹å®šå†…å®¹
            const rightKnowledgeCard = document.getElementById('right-panel-knowledge-card');
            if (rightKnowledgeCard) {
                rightKnowledgeCard.style.display = 'none';
            }
            
            // æ›´æ–°ä»£ç å®ç°æ ‡ç­¾é¡µ
            const codeDisplay = document.getElementById('code-display');
            if (codeDisplay) {
                codeDisplay.innerHTML = `
                    <div class="panel-section">
                        <h4>${detail.title} - ä»£ç å®ç°</h4>
                        <div class="code-block">${detail.code}</div>
                    </div>
                `;
            }
            
            // æ›´æ–°è¿è¡ŒçŠ¶æ€æ ‡ç­¾é¡µ
            const runtimeInfo = document.getElementById('node-runtime-info');
            if (runtimeInfo) {
                runtimeInfo.innerHTML = `
                    <div class="panel-section">
                        <h4>${detail.title} - è¿è¡ŒçŠ¶æ€</h4>
                        <div class="metrics-grid">
                            ${Object.entries(detail.runtime.metrics || {}).map(([key, value]) => `
                                <div class="metric-item">
                                    <div class="metric-value">${value}</div>
                                    <div class="metric-label">${key}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <strong>çŠ¶æ€ï¼š</strong> ${detail.runtime.status}
                        </div>
                    </div>
                `;
            }
        }
        
        // æ¸…é™¤èŠ‚ç‚¹é€‰æ‹©
        function clearNodeSelection() {
            if (currentSelectedNode) {
                const node = document.getElementById(currentSelectedNode + '-node');
                if (node) {
                    node.classList.remove('node-selected');
                }
            }
            currentSelectedNode = null;
            
            // é‡ç½®å³ä¾§é¢æ¿å†…å®¹
            resetRightPanel();
        }
        
        // é‡ç½®å³ä¾§é¢æ¿å†…å®¹
        function resetRightPanel() {
            const conceptInfo = document.getElementById('selected-node-info');
            if (conceptInfo) {
                conceptInfo.innerHTML = `
                    <p style="color: #666; text-align: center; padding: 20px;">
                        ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
                    </p>
                `;
            }
            
            const codeDisplay = document.getElementById('code-display');
            if (codeDisplay) {
                codeDisplay.innerHTML = `
                    <p style="color: #666; text-align: center; padding: 20px;">
                        ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹å¯¹åº”ä»£ç 
                    </p>
                `;
            }
            
            const runtimeInfo = document.getElementById('node-runtime-info');
            if (runtimeInfo) {
                runtimeInfo.innerHTML = `
                    <p style="color: #666; text-align: center; padding: 20px;">
                        ç‚¹å‡»å·¦ä¾§æµç¨‹å›¾ä¸­çš„ç»„ä»¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
                    </p>
                `;
            }
            
            // æ˜¾ç¤ºå³ä¾§çŸ¥è¯†å¡ç‰‡
            const rightKnowledgeCard = document.getElementById('right-panel-knowledge-card');
            if (rightKnowledgeCard) {
                rightKnowledgeCard.style.display = 'block';
            }
        }

        // åˆå§‹åŒ–å‘é‡ç©ºé—´å¯è§†åŒ–
        function initializeVectorVisualization() {
            const canvas = document.getElementById('vector-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }
            for (let i = 0; i <= height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#007bff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(width/2, 0);
            ctx.lineTo(width/2, height);
            ctx.moveTo(0, height/2);
            ctx.lineTo(width, height/2);
            ctx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = '#007bff';
            ctx.font = '14px sans-serif';
            ctx.fillText('ç»´åº¦1', width - 50, height/2 - 10);
            ctx.save();
            ctx.translate(20, 50);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('ç»´åº¦2', 0, 0);
            ctx.restore();
            
            // æ¨¡æ‹Ÿæ–‡æ¡£å‘é‡ï¼ˆè“ç‚¹ï¼‰- è°ƒæ•´åˆ°æ–°ç”»å¸ƒå°ºå¯¸
            const docVectors = [
                {x: 150, y: 120, label: 'PythonåŸºç¡€æ•™ç¨‹', similarity: 0.92},
                {x: 180, y: 140, label: 'Pythonç¼–ç¨‹å…¥é—¨', similarity: 0.89},
                {x: 350, y: 200, label: 'Javaå¼€å‘æŒ‡å—', similarity: 0.45},
                {x: 420, y: 280, label: 'æ•°æ®åº“è®¾è®¡', similarity: 0.35},
                {x: 200, y: 160, label: 'Pythonå‡½æ•°è¯¦è§£', similarity: 0.87},
                {x: 480, y: 120, label: 'Webå¼€å‘åŸºç¡€', similarity: 0.52},
                {x: 120, y: 300, label: 'ç®—æ³•ä¸æ•°æ®ç»“æ„', similarity: 0.68},
                {x: 380, y: 100, label: 'JavaScriptå…¥é—¨', similarity: 0.41}
            ];
            
            // ç»˜åˆ¶æ–‡æ¡£å‘é‡
            docVectors.forEach(vec => {
                // æ ¹æ®ç›¸ä¼¼åº¦è®¾ç½®é¢œè‰²æ·±åº¦
                const alpha = Math.max(0.3, vec.similarity);
                ctx.fillStyle = `rgba(102, 126, 234, ${alpha})`;
                ctx.beginPath();
                ctx.arc(vec.x, vec.y, 8, 0, 2 * Math.PI);
                ctx.fill();
                
                // è¾¹æ¡†
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // æ ‡ç­¾
                ctx.fillStyle = '#444';
                ctx.font = '12px sans-serif';
                const labelX = vec.x + 12;
                const labelY = vec.y + 4;
                ctx.fillText(vec.label, labelX, labelY);
                
                // ç›¸ä¼¼åº¦æ ‡ç­¾
                ctx.fillStyle = '#666';
                ctx.font = '10px sans-serif';
                ctx.fillText(`${(vec.similarity * 100).toFixed(0)}%`, labelX, labelY + 12);
            });
            
            // æŸ¥è¯¢å‘é‡ï¼ˆçº¢ç‚¹ï¼‰
            const queryVector = {x: 170, y: 130, label: 'æŸ¥è¯¢ï¼šPythonç¼–ç¨‹'};
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.arc(queryVector.x, queryVector.y, 12, 0, 2 * Math.PI);
            ctx.fill();
            
            // æŸ¥è¯¢å‘é‡è¾¹æ¡†
            ctx.strokeStyle = '#ff4757';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // æŸ¥è¯¢æ ‡ç­¾
            ctx.fillStyle = '#ff4757';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText(queryVector.label, queryVector.x + 15, queryVector.y - 10);
            
            // ç»˜åˆ¶ç›¸ä¼¼åº¦è¿çº¿ï¼ˆç»¿çº¿ï¼‰
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 4]);
            
            // åªè¿æ¥é«˜ç›¸ä¼¼åº¦çš„æ–‡æ¡£ï¼ˆç›¸ä¼¼åº¦ > 0.8ï¼‰
            const highSimilarityDocs = docVectors.filter(vec => vec.similarity > 0.8);
            highSimilarityDocs.forEach(vec => {
                const alpha = vec.similarity;
                ctx.strokeStyle = `rgba(40, 167, 69, ${alpha})`;
                ctx.beginPath();
                ctx.moveTo(queryVector.x, queryVector.y);
                ctx.lineTo(vec.x, vec.y);
                ctx.stroke();
                
                // åœ¨è¿çº¿ä¸­ç‚¹æ˜¾ç¤ºç›¸ä¼¼åº¦
                const midX = (queryVector.x + vec.x) / 2;
                const midY = (queryVector.y + vec.y) / 2;
                ctx.fillStyle = '#28a745';
                ctx.font = 'bold 11px sans-serif';
                ctx.fillText(`${(vec.similarity * 100).toFixed(0)}%`, midX, midY - 5);
            });
            
            // é‡ç½®çº¿æ¡æ ·å¼
            ctx.setLineDash([]);
            
            // æ·»åŠ å›¾ä¾‹
            const legendX = 20;
            const legendY = height - 80;
            
            // æŸ¥è¯¢å‘é‡å›¾ä¾‹
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.arc(legendX, legendY, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.fillText('æŸ¥è¯¢å‘é‡', legendX + 15, legendY + 4);
            
            // æ–‡æ¡£å‘é‡å›¾ä¾‹
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(legendX, legendY + 25, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillText('æ–‡æ¡£å‘é‡', legendX + 15, legendY + 29);
            
            // ç›¸ä¼¼åº¦è¿çº¿å›¾ä¾‹
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 4]);
            ctx.beginPath();
            ctx.moveTo(legendX - 5, legendY + 50);
            ctx.lineTo(legendX + 30, legendY + 50);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillText('é«˜ç›¸ä¼¼åº¦è¿æ¥', legendX + 35, legendY + 54);
        }

        // å¼€å§‹æ¼”ç¤º
        function startDemo() {
            if (isProcessing) return;
            
            isProcessing = true;
            currentStep = 0;
            
            document.getElementById('status-text').textContent = 'æ¼”ç¤ºè¿›è¡Œä¸­...';
            
            // æ ¹æ®å½“å‰æ¨¡å¼è¿è¡Œä¸åŒçš„æ¼”ç¤º
            if (currentMode === 'dev') {
                runDevDemo();
            } else if (currentMode === 'manage') {
                runManageDemo();
            } else if (currentMode === 'runtime') {
                runRuntimeDemo();
            }
        }

        // å¼€å‘æ€æ¼”ç¤º
        function runDevDemo() {
            const steps = [
                {node: 'config-node', delay: 500},
                {node: 'vectordb-node', delay: 800},
                {node: 'embedding-node', delay: 600},
                {node: 'ai-config-node', delay: 700},
                {node: 'router-node', delay: 900}
            ];
            
            runSteps(steps);
        }

        // ç®¡ç†æ€æ¼”ç¤º
        function runManageDemo() {
            const steps = [
                {node: 'doc-input-node', delay: 500},
                {node: 'doc-parse-node', delay: 800},
                {node: 'chunk-node', delay: 1000},
                {node: 'vectorize-node', delay: 1200},
                {node: 'store-node', delay: 600}
            ];
            
            runSteps(steps);
        }

        // è¿è¡Œæ€æ¼”ç¤º
        function runRuntimeDemo() {
            const steps = [
                {node: 'user-input-node', delay: 300, log: 'æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢'},
                {node: 'api-receive-node', delay: 400, log: 'FastAPIæ¥æ”¶è¯·æ±‚'},
                {node: 'session-mgmt-node', delay: 500, log: 'è·å–ä¼šè¯å†å²'},
                {node: 'tool-prep-node', delay: 600, log: 'å‡†å¤‡å·¥å…·å®šä¹‰'},
                {node: 'router-decision-node', delay: 800, log: 'ğŸš¦ æ™ºèƒ½è·¯ç”±å†³ç­–ï¼šéœ€è¦å·¥å…·è°ƒç”¨'},
                {node: 'model-v3-node', delay: 700, log: 'é€‰æ‹©DeepSeek-V3å¤„ç†å·¥å…·è°ƒç”¨'},
                {node: 'tool-call-node', delay: 900, log: 'æ‰§è¡Œsearch_courseå·¥å…·'},
                {node: 'vector-search-node', delay: 1000, log: 'å‘é‡æ•°æ®åº“æœç´¢å®Œæˆ'},
                {node: 'model-switch-node', delay: 800, log: 'ğŸ”„ æ¨¡å‹åˆ‡æ¢ï¼šV3 â†’ R1'},
                {node: 'result-integrate-node', delay: 1200, log: 'R1æ¨¡å‹æ•´åˆæœç´¢ç»“æœ'},
                {node: 'final-response-node', delay: 600, log: 'âœ… ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ'}
            ];
            
            addLog('å¼€å§‹V2.0åŒæ¨¡å‹å¤„ç†æµç¨‹');
            runSteps(steps);
        }
        
        // ç®¡ç†æ€èŠ‚ç‚¹è¯¦æƒ…æ•°æ®
        const manageNodeDetails = {
            'doc-input': {
                title: 'ğŸ“¥ æ–‡æ¡£è¾“å…¥',
                concept: {
                    why: 'ç³»ç»Ÿéœ€è¦å¤„ç†å„ç§æ ¼å¼çš„è¯¾ç¨‹ææ–™',
                    what: 'æ”¯æŒMarkdownã€PDFã€TXTç­‰æ–‡æ¡£æ ¼å¼çš„ä¸Šä¼ å’Œè¾“å…¥',
                    how: 'é€šè¿‡Webç•Œé¢ä¸Šä¼ æˆ–APIæ¥å£æ¥æ”¶æ–‡æ¡£æ•°æ®'
                },
                code: `<span class="comment"># backend/document_processor.py</span>
<span class="keyword">class</span> <span class="function">DocumentProcessor</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.supported_formats = [<span class="string">".md"</span>, <span class="string">".pdf"</span>, <span class="string">".txt"</span>, <span class="string">".docx"</span>]
        
    <span class="keyword">def</span> <span class="function">process_upload</span>(self, file_path: str):
        <span class="comment"># æ£€æŸ¥æ–‡ä»¶æ ¼å¼</span>
        file_ext = Path(file_path).suffix.lower()
        <span class="keyword">if</span> file_ext not <span class="keyword">in</span> self.supported_formats:
            <span class="keyword">raise</span> ValueError(f<span class="string">"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: {file_ext}"</span>)
            
        <span class="comment"># è¯»å–æ–‡ä»¶å†…å®¹</span>
        <span class="keyword">if</span> file_ext == <span class="string">".pdf"</span>:
            content = self._extract_pdf(file_path)
        <span class="keyword">elif</span> file_ext == <span class="string">".md"</span>:
            content = self._extract_markdown(file_path)
        <span class="keyword">else</span>:
            content = self._extract_text(file_path)
            
        <span class="keyword">return</span> {
            <span class="string">"content"</span>: content,
            <span class="string">"metadata"</span>: self._extract_metadata(file_path)
        }`,
                runtime: {
                    status: 'å¾…ä¸Šä¼ ',
                    metrics: {
                        'æ”¯æŒæ ¼å¼': '4ç§',
                        'æœ€å¤§æ–‡ä»¶': '10MB',
                        'å¤„ç†é€Ÿåº¦': '1MB/s'
                    }
                }
            },
            'doc-parse': {
                title: 'ğŸ” æ–‡æ¡£è§£æ',
                concept: {
                    why: 'ä¸åŒæ–‡æ¡£æ ¼å¼éœ€è¦ä¸åŒçš„è§£æç­–ç•¥',
                    what: 'æå–æ–‡æ¡£ä¸­çš„æ–‡æœ¬å†…å®¹å’Œç»“æ„ä¿¡æ¯',
                    how: 'ä½¿ç”¨ä¸“é—¨çš„è§£æåº“å¤„ç†ä¸åŒæ–‡ä»¶æ ¼å¼'
                },
                code: `<span class="comment"># ä¸åŒæ ¼å¼çš„è§£æç­–ç•¥</span>
<span class="keyword">def</span> <span class="function">_extract_pdf</span>(self, file_path: str):
    <span class="keyword">import</span> PyPDF2
    <span class="keyword">with</span> open(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> file:
        reader = PyPDF2.PdfReader(file)
        content = <span class="string">""</span>
        <span class="keyword">for</span> page <span class="keyword">in</span> reader.pages:
            content += page.extract_text() + <span class="string">"\\n"</span>
    <span class="keyword">return</span> content

<span class="keyword">def</span> <span class="function">_extract_markdown</span>(self, file_path: str):
    <span class="keyword">import</span> markdown
    <span class="keyword">with</span> open(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:
        md_content = file.read()
        <span class="comment"># ä¿ç•™åŸå§‹æ–‡æœ¬ï¼Œä¸è½¬æ¢ä¸ºHTML</span>
        <span class="keyword">return</span> md_content

<span class="keyword">def</span> <span class="function">_extract_text</span>(self, file_path: str):
    <span class="keyword">with</span> open(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:
        <span class="keyword">return</span> file.read()`,
                runtime: {
                    status: 'å°±ç»ª',
                    metrics: {
                        'PDFè§£æ': 'æ”¯æŒ',
                        'MDè§£æ': 'æ”¯æŒ',
                        'ç¼–ç æ”¯æŒ': 'UTF-8'
                    }
                }
            },
            'chunk': {
                title: 'âœ‚ï¸ æ–‡æœ¬åˆ†å—',
                concept: {
                    why: 'æ¨¡å‹è¾“å…¥é™åˆ¶å’Œæé«˜æœç´¢ç²¾åº¦',
                    what: 'å°†é•¿æ–‡æ¡£åˆ†å‰²æˆå°å—ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§',
                    how: 'æŒ‰å­—ç¬¦æ•°åˆ†å—ï¼Œè®¾ç½®é‡å åŒºé—´'
                },
                code: `<span class="comment"># æ–‡æœ¬åˆ†å—ç®—æ³•</span>
<span class="keyword">class</span> <span class="function">TextChunker</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, chunk_size=<span class="number">500</span>, overlap=<span class="number">100</span>):
        self.chunk_size = chunk_size
        self.overlap = overlap
        
    <span class="keyword">def</span> <span class="function">chunk_text</span>(self, text: str):
        chunks = []
        start = <span class="number">0</span>
        
        <span class="keyword">while</span> start < len(text):
            <span class="comment"># è®¡ç®—å—çš„ç»“æŸä½ç½®</span>
            end = start + self.chunk_size
            chunk = text[start:end]
            
            <span class="comment"># åœ¨å¥å­è¾¹ç•Œåˆ‡åˆ†ï¼ˆä¼˜åŒ–ï¼‰</span>
            <span class="keyword">if</span> end < len(text):
                boundary = self._find_sentence_boundary(text, end)
                <span class="keyword">if</span> boundary > start:
                    chunk = text[start:boundary]
                    
            chunks.append(chunk.strip())
            start = end - self.overlap
            
        <span class="keyword">return</span> chunks`,
                runtime: {
                    status: 'å°±ç»ª',
                    metrics: {
                        'å—å¤§å°': '500å­—ç¬¦',
                        'é‡å å¤§å°': '100å­—ç¬¦',
                        'åˆ‡åˆ†ç­–ç•¥': 'æ™ºèƒ½è¾¹ç•Œ'
                    }
                }
            },
            'vectorize': {
                title: 'ğŸ”¢ å‘é‡åŒ–',
                concept: {
                    why: 'è®¡ç®—æœºéœ€è¦æ•°å­—åŒ–è¡¨ç¤ºæ‰èƒ½ç†è§£è¯­ä¹‰',
                    what: 'ä½¿ç”¨MiniLM-L6æ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸º384ç»´å‘é‡',
                    how: 'é€šè¿‡è®­ç»ƒå¥½çš„ç¥ç»ç½‘ç»œæ¨¡å‹æå–è¯­ä¹‰ç‰¹å¾'
                },
                code: `<span class="comment"># å‘é‡åŒ–å¤„ç†å™¨</span>
<span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">class</span> <span class="function">VectorEmbedder</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, model_name=<span class="string">"all-MiniLM-L6-v2"</span>):
        self.model = SentenceTransformer(model_name)
        
    <span class="keyword">def</span> <span class="function">embed_chunks</span>(self, chunks: list):
        <span class="comment"># æ‰¹é‡å¤„ç†æé«˜æ•ˆç‡</span>
        embeddings = self.model.encode(chunks, 
                                     batch_size=<span class="number">32</span>,
                                     show_progress_bar=<span class="keyword">True</span>)
        
        <span class="comment"># å‘é‡æ­£è§„åŒ–ï¼ˆå¯é€‰ï¼‰</span>
        normalized_embeddings = embeddings / np.linalg.norm(
            embeddings, axis=<span class="number">1</span>, keepdims=<span class="keyword">True</span>
        )
        
        <span class="keyword">return</span> normalized_embeddings`,
                runtime: {
                    status: 'å°±ç»ª',
                    metrics: {
                        'æ¨¡å‹å¤§å°': '25MB',
                        'å‘é‡ç»´åº¦': '384',
                        'å¤„ç†é€Ÿåº¦': '1000å—/ç§’'
                    }
                }
            },
            'store': {
                title: 'ğŸ’¾ æ•°æ®å­˜å‚¨',
                concept: {
                    why: 'éœ€è¦æŒä¹…åŒ–å­˜å‚¨å‘é‡æ•°æ®ä¾›åç»­æœç´¢',
                    what: 'å°†æ–‡æœ¬å—å’Œå¯¹åº”å‘é‡å­˜å‚¨åˆ°ChromaDB',
                    how: 'ä½¿ç”¨å‘é‡æ•°æ®åº“çš„ä¸“ç”¨APIè¿›è¡Œå­˜å‚¨å’Œç´¢å¼•'
                },
                code: `<span class="comment"># ChromaDBå­˜å‚¨ç®¡ç†</span>
<span class="keyword">class</span> <span class="function">ChromaStorage</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, collection_name=<span class="string">"course_materials"</span>):
        self.client = chromadb.PersistentClient(path=<span class="string">"./chroma_db"</span>)
        self.collection = self.client.get_or_create_collection(
            name=collection_name,
            metadata={<span class="string">"hnsw:space"</span>: <span class="string">"cosine"</span>}  <span class="comment"># ä½™å¼¦ç›¸ä¼¼åº¦</span>
        )
        
    <span class="keyword">def</span> <span class="function">store_chunks</span>(self, chunks: list, embeddings: list, metadata: list):
        <span class="comment"># æ‰¹é‡å­˜å‚¨</span>
        ids = [f<span class="string">"chunk_{i}"</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(chunks))]
        
        self.collection.add(
            embeddings=embeddings.tolist(),
            documents=chunks,
            metadatas=metadata,
            ids=ids
        )
        
        <span class="keyword">return</span> len(chunks)`,
                runtime: {
                    status: 'è¿è¡Œä¸­',
                    metrics: {
                        'å­˜å‚¨å—æ•°': '0',
                        'æ•°æ®åº“å¤§å°': '0MB',
                        'æœç´¢å»¶è¿Ÿ': '<50ms'
                    }
                }
            }
        };
        
        // è¿è¡Œæ€èŠ‚ç‚¹è¯¦æƒ…æ•°æ®
        const runtimeNodeDetails = {
            'user-input': {
                title: 'ğŸ” ç”¨æˆ·è¾“å…¥',
                concept: {
                    why: 'ç”¨æˆ·éœ€è¦è·å–è¯¾ç¨‹ç›¸å…³ä¿¡æ¯æˆ–è§£ç­”ç–‘é—®',
                    what: 'æ¥æ”¶ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢è¯·æ±‚',
                    how: 'é€šè¿‡Webç•Œé¢æ”¶é›†ç”¨æˆ·è¾“å…¥çš„é—®é¢˜æ–‡æœ¬'
                },
                code: `<span class="comment"># frontend/query_interface.py</span>
<span class="keyword">def</span> <span class="function">handle_user_input</span>(query: str):
    <span class="comment"># è¾“å…¥éªŒè¯</span>
    <span class="keyword">if</span> not query or len(query.strip()) < <span class="number">3</span>:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">"æŸ¥è¯¢å†…å®¹è¿‡çŸ­"</span>}
    
    <span class="comment"># æ¸…ç†å’Œé¢„å¤„ç†</span>
    clean_query = query.strip().replace(<span class="string">"\\n"</span>, <span class="string">" "</span>)
    
    <span class="comment"># è®°å½•ç”¨æˆ·æŸ¥è¯¢</span>
    log_user_query(clean_query)
    
    <span class="keyword">return</span> {
        <span class="string">"query"</span>: clean_query,
        <span class="string">"timestamp"</span>: datetime.now(),
        <span class="string">"session_id"</span>: get_session_id()
    }`,
                runtime: {
                    status: 'ç­‰å¾…è¾“å…¥',
                    metrics: {
                        'æŸ¥è¯¢é•¿åº¦': '0å­—ç¬¦',
                        'å¤„ç†æ—¶é—´': '<1ms',
                        'éªŒè¯çŠ¶æ€': 'å¾…éªŒè¯'
                    }
                }
            },
            'api-receive': {
                title: 'ğŸŒ APIæ¥æ”¶',
                concept: {
                    why: 'FastAPIä½œä¸ºåç«¯æœåŠ¡æ¥æ”¶å‰ç«¯è¯·æ±‚',
                    what: 'å¤„ç†HTTP POSTè¯·æ±‚ï¼Œè§£ææŸ¥è¯¢å‚æ•°',
                    how: 'é€šè¿‡RESTful APIç«¯ç‚¹æ¥æ”¶å¹¶éªŒè¯è¯·æ±‚æ•°æ®'
                },
                code: `<span class="comment"># backend/app.py</span>
@app.post(<span class="string">"/query"</span>)
<span class="keyword">async def</span> <span class="function">query_endpoint</span>(request: QueryRequest):
    <span class="comment"># æ¥æ”¶æŸ¥è¯¢è¯·æ±‚</span>
    query_data = {
        <span class="string">"query"</span>: request.query,
        <span class="string">"session_id"</span>: request.session_id,
        <span class="string">"timestamp"</span>: datetime.now()
    }
    
    <span class="comment"># è®°å½•è¯·æ±‚æ—¥å¿—</span>
    logger.info(f<span class="string">"æ”¶åˆ°æŸ¥è¯¢: {request.query[:50]}..."</span>)
    
    <span class="comment"># è°ƒç”¨RAGå¤„ç†å™¨</span>
    response = <span class="keyword">await</span> rag_processor.process(query_data)
    
    <span class="keyword">return</span> response`,
                runtime: {
                    status: 'ç›‘å¬ä¸­',
                    metrics: {
                        'ç«¯å£': '8000',
                        'è¯·æ±‚æ•°': '0',
                        'å¹³å‡å“åº”': '0ms'
                    }
                }
            }
            },
            'session-mgmt': {
                title: 'ğŸ“‹ ä¼šè¯ç®¡ç†',
                concept: {
                    why: 'ç»´æŒç”¨æˆ·å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œæä¾›è¿è´¯çš„äº¤äº’ä½“éªŒ',
                    what: 'ç®¡ç†ç”¨æˆ·ä¼šè¯çŠ¶æ€ï¼Œå­˜å‚¨å†å²å¯¹è¯è®°å½•',
                    how: 'ä½¿ç”¨session IDè·Ÿè¸ªç”¨æˆ·çŠ¶æ€å’Œå¯¹è¯å†å²'
                },
                code: `<span class="comment"># backend/session_manager.py</span>
<span class="keyword">class</span> <span class="function">SessionManager</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>):
        <span class="keyword">self</span>.sessions = {}
        <span class="keyword">self</span>.max_history = <span class="number">10</span>
    
    <span class="keyword">def</span> <span class="function">get_session</span>(<span class="keyword">self</span>, session_id: str):
        <span class="keyword">if</span> session_id not <span class="keyword">in</span> <span class="keyword">self</span>.sessions:
            <span class="keyword">self</span>.sessions[session_id] = {
                <span class="string">"history"</span>: [],
                <span class="string">"context"</span>: {},
                <span class="string">"created_at"</span>: datetime.now()
            }
        <span class="keyword">return</span> <span class="keyword">self</span>.sessions[session_id]`,
                runtime: {
                    status: 'æ´»è·ƒä¼šè¯',
                    metrics: {
                        'ä¼šè¯æ•°': '1',
                        'å†å²è®°å½•': '0æ¡',
                        'å†…å­˜ä½¿ç”¨': '1.2MB'
                    }
                }
            },
            'tool-prep': {
                title: 'ğŸ”§ å·¥å…·å‡†å¤‡',
                concept: {
                    why: 'ä¸ºAIæ¨¡å‹å‡†å¤‡æ ‡å‡†åŒ–çš„å·¥å…·å’Œå‡½æ•°è°ƒç”¨æ ¼å¼',
                    what: 'è½¬æ¢æŸ¥è¯¢ä¸ºæ¨¡å‹å¯ç†è§£çš„å·¥å…·è°ƒç”¨æ ¼å¼',
                    how: 'æ„å»ºfunction schemaå’Œå‚æ•°ï¼Œå‡†å¤‡tool calling'
                },
                code: `<span class="comment"># backend/tool_processor.py</span>
<span class="keyword">def</span> <span class="function">prepare_tools</span>(query: str, session_context: dict):
    tools = [
        {
            <span class="string">"name"</span>: <span class="string">"search_documents"</span>,
            <span class="string">"description"</span>: <span class="string">"æœç´¢ç›¸å…³è¯¾ç¨‹æ–‡æ¡£"</span>,
            <span class="string">"parameters"</span>: {
                <span class="string">"type"</span>: <span class="string">"object"</span>,
                <span class="string">"properties"</span>: {
                    <span class="string">"query"</span>: {<span class="string">"type"</span>: <span class="string">"string"</span>}
                }
            }
        }
    ]
    
    <span class="keyword">return</span> {
        <span class="string">"tools"</span>: tools,
        <span class="string">"query"</span>: query,
        <span class="string">"context"</span>: session_context
    }`,
                runtime: {
                    status: 'å·¥å…·å°±ç»ª',
                    metrics: {
                        'å¯ç”¨å·¥å…·': '3ä¸ª',
                        'å‡†å¤‡æ—¶é—´': '2ms',
                        'æ ¼å¼æ£€æŸ¥': 'é€šè¿‡'
                    }
                }
            },
            'router-decision': {
                title: 'ğŸš¦ è·¯ç”±å†³ç­–',
                concept: {
                    why: 'æ™ºèƒ½åˆ¤æ–­æŸ¥è¯¢ç±»å‹ï¼Œé€‰æ‹©æœ€ä¼˜å¤„ç†è·¯å¾„',
                    what: 'åˆ†ææŸ¥è¯¢å†…å®¹ï¼Œå†³å®šä½¿ç”¨ç›´æ¥å›ç­”è¿˜æ˜¯RAGæ£€ç´¢',
                    how: 'åŸºäºæŸ¥è¯¢ç‰¹å¾å’Œè§„åˆ™å¼•æ“è¿›è¡Œè·¯ç”±å†³ç­–'
                },
                code: `<span class="comment"># backend/router.py</span>
<span class="keyword">class</span> <span class="function">QueryRouter</span>:
    <span class="keyword">def</span> <span class="function">route</span>(<span class="keyword">self</span>, query: str) -> str:
        <span class="comment"># ç®€å•é—®å€™å¤„ç†</span>
        <span class="keyword">if</span> <span class="keyword">self</span>._is_greeting(query):
            <span class="keyword">return</span> <span class="string">"direct"</span>
        
        <span class="comment"># çŸ¥è¯†æŸ¥è¯¢æ£€æµ‹</span>
        <span class="keyword">if</span> <span class="keyword">self</span>._needs_knowledge(query):
            <span class="keyword">return</span> <span class="string">"rag"</span>
        
        <span class="comment"># é»˜è®¤ä½¿ç”¨RAG</span>
        <span class="keyword">return</span> <span class="string">"rag"</span>
    
    <span class="keyword">def</span> <span class="function">_needs_knowledge</span>(<span class="keyword">self</span>, query: str) -> bool:
        knowledge_keywords = [<span class="string">"ä»€ä¹ˆæ˜¯"</span>, <span class="string">"å¦‚ä½•"</span>, <span class="string">"è§£é‡Š"</span>]
        <span class="keyword">return</span> any(kw <span class="keyword">in</span> query <span class="keyword">for</span> kw <span class="keyword">in</span> knowledge_keywords)`,
                runtime: {
                    status: 'å†³ç­–å®Œæˆ',
                    metrics: {
                        'è·¯ç”±ç»“æœ': 'RAGè·¯å¾„',
                        'å†³ç­–æ—¶é—´': '5ms',
                        'ç½®ä¿¡åº¦': '85%'
                    }
                }
            },
            'model-v3': {
                title: 'ğŸ¤– æ¨¡å‹V3',
                concept: {
                    why: 'Claude 3ä½œä¸ºä¸»è¦æ¨ç†å¼•æ“å¤„ç†å¤æ‚æŸ¥è¯¢',
                    what: 'ä½¿ç”¨Claude 3 Sonnetè¿›è¡Œé«˜è´¨é‡æ–‡æœ¬ç”Ÿæˆ',
                    how: 'å‘é€æ ¼å¼åŒ–è¯·æ±‚åˆ°Anthropic APIè·å–å“åº”'
                },
                code: `<span class="comment"># backend/claude_client.py</span>
<span class="keyword">class</span> <span class="function">ClaudeClient</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>, api_key: str):
        <span class="keyword">self</span>.client = anthropic.Anthropic(api_key=api_key)
    
    <span class="keyword">async def</span> <span class="function">generate</span>(<span class="keyword">self</span>, messages: list, tools=None):
        response = <span class="keyword">await</span> <span class="keyword">self</span>.client.messages.create(
            model=<span class="string">"claude-3-sonnet-20240229"</span>,
            max_tokens=<span class="number">2048</span>,
            messages=messages,
            tools=tools <span class="keyword">if</span> tools <span class="keyword">else</span> None
        )
        
        <span class="keyword">return</span> response`,
                runtime: {
                    status: 'æ¨ç†ä¸­',
                    metrics: {
                        'æ¨¡å‹ç‰ˆæœ¬': 'Claude-3-Sonnet',
                        'Tokenä½¿ç”¨': '156/2048',
                        'å“åº”æ—¶é—´': '1.2s'
                    }
                }
            },
            'tool-call': {
                title: 'ğŸ› ï¸ å·¥å…·è°ƒç”¨',
                concept: {
                    why: 'æ‰§è¡Œæ¨¡å‹å†³å®šè°ƒç”¨çš„å…·ä½“å·¥å…·å‡½æ•°',
                    what: 'æ ¹æ®æ¨¡å‹è¾“å‡ºæ‰§è¡Œç›¸åº”çš„å·¥å…·è°ƒç”¨',
                    how: 'è§£ætool callå‚æ•°ï¼Œæ‰§è¡Œå¯¹åº”å‡½æ•°å¹¶è¿”å›ç»“æœ'
                },
                code: `<span class="comment"># backend/tool_executor.py</span>
<span class="keyword">class</span> <span class="function">ToolExecutor</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>, vector_store):
        <span class="keyword">self</span>.vector_store = vector_store
    
    <span class="keyword">async def</span> <span class="function">execute</span>(<span class="keyword">self</span>, tool_call):
        <span class="keyword">if</span> tool_call.name == <span class="string">"search_documents"</span>:
            query = tool_call.parameters[<span class="string">"query"</span>]
            results = <span class="keyword">await</span> <span class="keyword">self</span>.vector_store.search(
                query, limit=<span class="number">5</span>
            )
            <span class="keyword">return</span> {
                <span class="string">"results"</span>: results,
                <span class="string">"count"</span>: len(results)
            }`,
                runtime: {
                    status: 'æ‰§è¡Œä¸­',
                    metrics: {
                        'è°ƒç”¨å·¥å…·': 'search_documents',
                        'æ‰§è¡Œæ—¶é—´': '45ms',
                        'ç»“æœæ•°é‡': '5ä¸ª'
                    }
                }
            },
            'vector-search': {
                title: 'ğŸ” å‘é‡æœç´¢',
                concept: {
                    why: 'åœ¨é«˜ç»´å‘é‡ç©ºé—´ä¸­æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„æ–‡æ¡£',
                    what: 'ä½¿ç”¨ChromaDBè¿›è¡Œè¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢',
                    how: 'å°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡ï¼Œè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦å¹¶è¿”å›TopKç»“æœ'
                },
                code: `<span class="comment"># backend/vector_store.py</span>
<span class="keyword">class</span> <span class="function">VectorStore</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>, collection_name: str):
        <span class="keyword">self</span>.client = chromadb.Client()
        <span class="keyword">self</span>.collection = <span class="keyword">self</span>.client.get_or_create_collection(
            name=collection_name
        )
    
    <span class="keyword">async def</span> <span class="function">search</span>(<span class="keyword">self</span>, query: str, limit: int = <span class="number">5</span>):
        results = <span class="keyword">self</span>.collection.query(
            query_texts=[query],
            n_results=limit,
            include=[<span class="string">"documents"</span>, <span class="string">"distances"</span>, <span class="string">"metadatas"</span>]
        )
        
        <span class="keyword">return</span> <span class="keyword">self</span>._format_results(results)`,
                runtime: {
                    status: 'æœç´¢å®Œæˆ',
                    metrics: {
                        'æœç´¢ç»´åº¦': '384ç»´',
                        'æ–‡æ¡£æ•°é‡': '1,247ä¸ª',
                        'ç›¸ä¼¼åº¦': '0.85+'
                    }
                }
            },
            'model-r1-direct': {
                title: 'âš¡ æ¨¡å‹R1ç›´æ¥',
                concept: {
                    why: 'å¯¹äºç®€å•æŸ¥è¯¢æä¾›å¿«é€Ÿç›´æ¥å›ç­”',
                    what: 'ä½¿ç”¨è½»é‡çº§æ¨¡å‹å¤„ç†æ— éœ€æ£€ç´¢çš„æŸ¥è¯¢',
                    how: 'ç»•è¿‡å‘é‡æœç´¢ï¼Œç›´æ¥ç”Ÿæˆå›ç­”ä»¥æé«˜å“åº”é€Ÿåº¦'
                },
                code: `<span class="comment"># backend/direct_responder.py</span>
<span class="keyword">class</span> <span class="function">DirectResponder</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>, model_client):
        <span class="keyword">self</span>.client = model_client
        <span class="keyword">self</span>.quick_responses = {
            <span class="string">"ä½ å¥½"</span>: <span class="string">"ä½ å¥½ï¼æˆ‘æ˜¯è¯¾ç¨‹åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"</span>,
            <span class="string">"è°¢è°¢"</span>: <span class="string">"ä¸å®¢æ°”ï¼å¾ˆé«˜å…´èƒ½å¸®åŠ©åˆ°ä½ ã€‚"</span>
        }
    
    <span class="keyword">async def</span> <span class="function">respond</span>(<span class="keyword">self</span>, query: str):
        <span class="comment"># æ£€æŸ¥å¿«é€Ÿå›å¤</span>
        <span class="keyword">for</span> key, response <span class="keyword">in</span> <span class="keyword">self</span>.quick_responses.items():
            <span class="keyword">if</span> key <span class="keyword">in</span> query:
                <span class="keyword">return</span> response
        
        <span class="comment"># ä½¿ç”¨æ¨¡å‹ç”Ÿæˆ</span>
        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">self</span>.client.quick_generate(query)`,
                runtime: {
                    status: 'å¿«é€Ÿå“åº”',
                    metrics: {
                        'å“åº”ç±»å‹': 'ç›´æ¥å›ç­”',
                        'å¤„ç†æ—¶é—´': '12ms',
                        'ç¼“å­˜å‘½ä¸­': 'æ˜¯'
                    }
                }
            },
            'model-switch': {
                title: 'ğŸ”„ æ¨¡å‹åˆ‡æ¢',
                concept: {
                    why: 'æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦å’Œæ€§èƒ½è¦æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡å‹',
                    what: 'åœ¨ä¸åŒAIæ¨¡å‹ä¹‹é—´è¿›è¡Œæ™ºèƒ½åˆ‡æ¢',
                    how: 'åŸºäºæŸ¥è¯¢åˆ†æç»“æœé€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹è¿›è¡Œå¤„ç†'
                },
                code: `<span class="comment"># backend/model_switcher.py</span>
<span class="keyword">class</span> <span class="function">ModelSwitcher</span>:
    <span class="keyword">def __init__</span>(<span class="keyword">self</span>):
        <span class="keyword">self</span>.models = {
            <span class="string">"fast"</span>: <span class="string">"claude-3-haiku"</span>,
            <span class="string">"balanced"</span>: <span class="string">"claude-3-sonnet"</span>,
            <span class="string">"advanced"</span>: <span class="string">"claude-3-opus"</span>
        }
    
    <span class="keyword">def</span> <span class="function">select_model</span>(<span class="keyword">self</span>, query_complexity: str, context_length: int):
        <span class="keyword">if</span> context_length > <span class="number">10000</span> <span class="keyword">or</span> query_complexity == <span class="string">"high"</span>:
            <span class="keyword">return</span> <span class="keyword">self</span>.models[<span class="string">"advanced"</span>]
        <span class="keyword">elif</span> query_complexity == <span class="string">"medium"</span>:
            <span class="keyword">return</span> <span class="keyword">self</span>.models[<span class="string">"balanced"</span>]
        <span class="keyword">else</span>:
            <span class="keyword">return</span> <span class="keyword">self</span>.models[<span class="string">"fast"</span>]`,
                runtime: {
                    status: 'æ¨¡å‹é€‰æ‹©',
                    metrics: {
                        'å½“å‰æ¨¡å‹': 'claude-3-sonnet',
                        'åˆ‡æ¢åŸå› ': 'æŸ¥è¯¢å¤æ‚åº¦',
                        'é€‰æ‹©æ—¶é—´': '3ms'
                    }
                }
            },
            'result-integrate': {
                title: 'ğŸ”— ç»“æœæ•´åˆ',
                concept: {
                    why: 'å°†æ£€ç´¢ç»“æœå’ŒAIç”Ÿæˆå†…å®¹æ•´åˆä¸ºè¿è´¯å›ç­”',
                    what: 'åˆå¹¶å‘é‡æœç´¢ç»“æœå’Œæ¨¡å‹ç”Ÿæˆçš„å›ç­”',
                    how: 'ä½¿ç”¨æ¨¡æ¿å’Œè§„åˆ™å°†å¤šä¸ªä¿¡æ¯æºæ•´åˆä¸ºæœ€ç»ˆå“åº”'
                },
                code: `<span class="comment"># backend/result_integrator.py</span>
<span class="keyword">class</span> <span class="function">ResultIntegrator</span>:
    <span class="keyword">def</span> <span class="function">integrate</span>(<span class="keyword">self</span>, search_results: list, ai_response: str):
        <span class="comment"># æå–ç›¸å…³æ–‡æ¡£</span>
        sources = []
        <span class="keyword">for</span> result <span class="keyword">in</span> search_results:
            <span class="keyword">if</span> result[<span class="string">"distance"</span>] < <span class="number">0.3</span>:  <span class="comment"># é«˜ç›¸ä¼¼åº¦</span>
                sources.append({
                    <span class="string">"content"</span>: result[<span class="string">"document"</span>],
                    <span class="string">"metadata"</span>: result[<span class="string">"metadata"</span>]
                })
        
        <span class="comment"># æ•´åˆå›ç­”</span>
        integrated_response = {
            <span class="string">"answer"</span>: ai_response,
            <span class="string">"sources"</span>: sources,
            <span class="string">"confidence"</span>: <span class="keyword">self</span>._calculate_confidence(sources)
        }
        
        <span class="keyword">return</span> integrated_response`,
                runtime: {
                    status: 'æ•´åˆå®Œæˆ',
                    metrics: {
                        'å¼•ç”¨æºæ•°': '3ä¸ª',
                        'ç½®ä¿¡åº¦': '92%',
                        'å“åº”é•¿åº¦': '247å­—'
                    }
                }
            },
            'final-response': {
                title: 'ğŸ“¤ æœ€ç»ˆå“åº”',
                concept: {
                    why: 'å‘ç”¨æˆ·è¿”å›æ ¼å¼åŒ–çš„æœ€ç»ˆå›ç­”',
                    what: 'æ•´ç†å¹¶æ ¼å¼åŒ–å›ç­”å†…å®¹ï¼Œå‡†å¤‡è¿”å›ç»™ç”¨æˆ·',
                    how: 'æ·»åŠ å…ƒæ•°æ®ï¼Œæ ¼å¼åŒ–è¾“å‡ºï¼Œè®°å½•å“åº”æ—¥å¿—'
                },
                code: `<span class="comment"># backend/response_formatter.py</span>
<span class="keyword">class</span> <span class="function">ResponseFormatter</span>:
    <span class="keyword">def</span> <span class="function">format</span>(<span class="keyword">self</span>, integrated_result: dict, query_info: dict):
        response = {
            <span class="string">"answer"</span>: integrated_result[<span class="string">"answer"</span>],
            <span class="string">"sources"</span>: integrated_result[<span class="string">"sources"</span>],
            <span class="string">"metadata"</span>: {
                <span class="string">"query_id"</span>: query_info[<span class="string">"id"</span>],
                <span class="string">"processing_time"</span>: query_info[<span class="string">"duration"</span>],
                <span class="string">"confidence"</span>: integrated_result[<span class="string">"confidence"</span>],
                <span class="string">"timestamp"</span>: datetime.now().isoformat()
            }
        }
        
        <span class="comment"># è®°å½•æ—¥å¿—</span>
        logger.info(f<span class="string">"å“åº”å·²ç”Ÿæˆ: {response['metadata']['query_id']}"</span>)
        
        <span class="keyword">return</span> response`,
                runtime: {
                    status: 'å“åº”å°±ç»ª',
                    metrics: {
                        'æ€»å¤„ç†æ—¶é—´': '1.8s',
                        'å“åº”çŠ¶æ€': '200 OK',
                        'å­—ç¬¦æ•°': '247ä¸ª'
                    }
                }
            }
        };
        
        // æ˜¾ç¤ºè¿è¡Œæ€èŠ‚ç‚¹è¯¦æƒ…
        function showRuntimeNodeDetail(nodeId) {
            // ä¼˜å…ˆä½¿ç”¨è¿è¡Œæ€ç‰¹å®šçš„èŠ‚ç‚¹æ•°æ®
            const detail = runtimeNodeDetails[nodeId] || nodeDetails[nodeId];
            if (detail) {
                showNodeDetail(nodeId, detail);
            }
        }
        
        // æ˜¾ç¤ºç®¡ç†æ€èŠ‚ç‚¹è¯¦æƒ…
        function showManageNodeDetail(nodeId) {
            // ä¼˜å…ˆä½¿ç”¨ç®¡ç†æ€ç‰¹å®šçš„èŠ‚ç‚¹æ•°æ®
            const detail = manageNodeDetails[nodeId] || nodeDetails[nodeId];
            if (detail) {
                showNodeDetail(nodeId, detail);
            }
        }

        // æ‰§è¡Œæ­¥éª¤
        function runSteps(steps) {
            let index = 0;
            
            function processNext() {
                if (index >= steps.length) {
                    isProcessing = false;
                    document.getElementById('status-text').textContent = 'æ¼”ç¤ºå®Œæˆ';
                    updateProgress(100);
                    return;
                }
                
                const step = steps[index];
                const node = document.getElementById(step.node);
                
                if (node) {
                    // æ¿€æ´»èŠ‚ç‚¹
                    node.classList.add('active');
                    
                    // æ›´æ–°è¿›åº¦
                    updateProgress((index + 1) / steps.length * 100);
                    
                    // æ·»åŠ æ—¥å¿—
                    addLog(`å¤„ç†ï¼š${step.node.replace('-node', '')}`);
                }
                
                // æ ‡è®°ä¸ºå®Œæˆå¹¶ç»§ç»­
                setTimeout(() => {
                    if (node) {
                        node.classList.remove('active');
                        node.classList.add('completed');
                    }
                    index++;
                    processNext();
                }, step.delay);
            }
            
            processNext();
        }

        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            isProcessing = false;
            currentStep = 0;
            
            // é‡ç½®æ‰€æœ‰èŠ‚ç‚¹
            resetNodes();
            
            // é‡ç½®è¿›åº¦
            updateProgress(0);
            
            // é‡ç½®çŠ¶æ€
            document.getElementById('status-text').textContent = 'å‡†å¤‡å°±ç»ª';
            
            // æ¸…ç©ºæ—¥å¿—
            document.getElementById('runtime-log').innerHTML = '[ç³»ç»Ÿ] å·²é‡ç½®';
        }

        // é‡ç½®èŠ‚ç‚¹çŠ¶æ€
        function resetNodes() {
            document.querySelectorAll('.flow-node').forEach(node => {
                node.classList.remove('active', 'completed');
            });
            document.querySelectorAll('.pipeline-path').forEach(path => {
                path.classList.remove('active');
            });
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
        }

        // æ›´æ–°æŒ‡æ ‡
        function updateMetrics() {
            document.getElementById('time-metric').textContent = '0.0s';
            document.getElementById('docs-metric').textContent = '0';
            document.getElementById('vectors-metric').textContent = '384';
            document.getElementById('similarity-metric').textContent = '0%';
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logEl = document.getElementById('runtime-log');
            const time = new Date().toLocaleTimeString();
            const logEntry = `[${time}] ${message}\n`;
            logEl.textContent = logEntry + logEl.textContent;
            
            // é™åˆ¶æ—¥å¿—é•¿åº¦
            const lines = logEl.textContent.split('\n');
            if (lines.length > 10) {
                logEl.textContent = lines.slice(0, 10).join('\n');
            }
        }

        // æ·»åŠ æç¤º
        function addTooltips() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šäº¤äº’æç¤º
        }
    </script>
</body>
</html>